import{d as ne,O as Ue,e as g,f as a,K as $,t as p,h as U,y as r,g as t,a3 as Ee,n as Ge,j as v,u as Be,M as Me,a as qe,H as ze,r as u,o as Re,E as F,U as Oe,p as Ne,k as De,F as P,i as j,w as Ae,Y as xe,Q as I,b as Pe,_ as je}from"./index-RlNAeXbs.js";import{_ as f}from"./FormInputText.vue_vue_type_script_setup_true_lang-T_FOMeE3.js";import{s as He}from"./textarea.esm-AA4WEdqy.js";import{a as We,u as Ke}from"./vee-validate.esm-n5tXILJ_.js";import{s as z}from"./dropdown.esm-spvGu--j.js";import{s as se}from"./inputnumber.esm-JvpHGqPa.js";import{h as Qe,s as H}from"./panel.esm-UrECo1nV.js";import{s as W}from"./divider.esm-I9s7hdop.js";import{r as Ye}from"./real-estate-service.store-4IUsLPNP.js";import{h as Je}from"./house.store-RzfSh9JR.js";import{a as te}from"./axios.config-EMV3l8KB.js";import{a as oe,s as R,i as ie}from"./toast-FY7odgkM.js";import{v as Xe}from"./validation-permissions-Jdo5j5M7.js";import"./inputtext.esm-d-sngYVx.js";import"./overlayeventbus.esm-WS9E9e-Q.js";import"./index.esm-fDPMfQXX.js";import"./index.esm-SJKm37ag.js";import"./index.esm-OUpHlj66.js";const Ze={class:"flex flex-column gap-2 mb-3 w-full"},ea=["for"],aa={key:0,class:"text-red-500"},la=["id"],sa=ne({__name:"FormEditTextArea",props:{name:{},label:{},required:{type:Boolean},placeholder:{},value:{}},setup(k){const i=k,{value:h,errorMessage:E}=We(()=>i.name);return Ue(()=>i.value,_=>{h.value=_}),(_,s)=>(v(),g("div",Ze,[a("label",{for:_.name},[$(p(_.label)+" ",1),_.required?(v(),g("span",aa," *")):U("",!0)],8,ea),r(t(He),{"auto-resize":"",rows:"5",modelValue:t(h),"onUpdate:modelValue":s[0]||(s[0]=m=>Ee(h)?h.value=m:null),id:_.name,class:Ge({"p-invalid":t(E)}),"aria-describedby":`text-error-${_.name}`,placeholder:_.placeholder},null,8,["modelValue","id","class","aria-describedby","placeholder"]),a("small",{class:"p-error",id:`text-error-${_.name}`},p(t(E)),9,la)]))}}),b=k=>(Ne("data-v-a4a56876"),k=k(),De(),k),ta={class:"card"},oa={class:"flex flex-wrap gap-2 align-items-center justify-content-between"},ia={class:"p-input-icon-left w-full sm:w-20rem flex-order-1 sm:flex-order-0"},na=b(()=>a("i",{class:"pi pi-arrow-left",style:{color:"green"}},null,-1)),ra=b(()=>a("br",null,null,-1)),da={class:"columns is-12 is-multiline",style:{"margin-top":"20px"}},ca={class:"column is-mobile-12 is-2"},ma=b(()=>a("span",{class:"text-red-500"}," *",-1)),ua={class:"column is-mobile-12 is-2"},pa=b(()=>a("span",{class:"text-red-500"}," *",-1)),ha={class:"column is-mobile-12 is-2"},_a=b(()=>a("span",{class:"text-red-500"}," *",-1)),ga={class:"column is-mobile-12 is-2"},va={class:"column is-mobile-12 is-2"},ya={class:"column is-mobile-12 is-2"},fa={class:"column is-mobile-12 is-4 set-margin-top"},ba={class:"column is-mobile-12 is-2 set-margin-top"},wa={class:"column is-mobile-12 is-2 set-margin-top"},$a={class:"column is-mobile-12 is-2 set-margin-top"},Sa={class:"column is-mobile-12 is-2 set-margin-top"},Va={class:"column is-mobile-12 is-2 set-margin-top"},ka={class:"column is-mobile-12 is-2 set-margin-top"},Ta={class:"column is-mobile-12 is-8 set-margin-top"},Ia={class:"column is-mobile-12 is-12 set-margin-top"},Ca={class:"column is-12"},La={class:"column is-3"},Fa=b(()=>a("span",{class:"text-red-500"}," *",-1)),Ua={class:"column is-3"},Ea=b(()=>a("span",{class:"text-red-500"}," *",-1)),Ga={key:0,class:"column is-5"},Ba=["onUpdate:modelValue","placeholder"],Ma={key:1,class:"column is-5"},qa={class:"column is-1"},za=["onClick"],Ra=b(()=>a("i",{class:"pi pi-times-circle"},null,-1)),Oa=[Ra],Na={class:"column is-mobile-12 is-12"},Da={class:"column is-12"},Aa={class:"columns is-12 is-multiline"},xa={class:"column is-mobile-12 is-3"},Pa={class:"card",style:{padding:"0rem !important"}},ja={class:"card-image"},Ha={class:"image is-4by3"},Wa=["src"],Ka={class:"content",style:{display:"flex","justify-content":"center"}},Qa={style:{padding:"10px !important"}},Ya={class:"column is-12"},Ja={class:"columns is-12 is-multiline"},Xa={class:"card",style:{padding:"0rem !important"}},Za={class:"card-image"},el={class:"image is-4by3"},al=["src"],ll={class:"content",style:{display:"flex","justify-content":"center"}},sl={style:{padding:"10px !important"}},tl=b(()=>a("span",{style:{"margin-left":"10px"}},null,-1)),ol={class:"column is-mobile-12 is-12",style:{"text-align":"right"}},il={key:0,class:"column is-mobile-12 is-12"},nl={class:"column is-mobile-12 is-12 text-right"},rl=b(()=>a("i",{class:"pi pi-save",style:{"margin-right":"8px"}},null,-1)),dl=ne({__name:"EditHouse",setup(k){const{t:i}=Be(),h=Me(),E=qe(),_=ze(),{form:s,state:m,update:re,getOne:de,houseGetByOne:ce,deleteGallery:me,updateGallery:ue,addGallery:pe}=Je(),{getOne:he,realestateType:_e}=Ye(),C=u(),S=u(),K=u([{id:"",image:""}]),T=u(),Q=u(),Y=localStorage.getItem("token"),ge=async()=>{E.push({name:"owner.house"})},ve=async()=>{s.prices&&(s.prices.length>2?h.add({severity:"error",summary:i("toast.summary.must_be_length_three"),detail:i("toast.detail.cancel_delete"),life:3e3}):s.prices.push({price:"",unit_price:"",detail:""}))},ye=async e=>{s.prices&&s.prices.splice(e,1)},fe={village:i("placeholder.inputText"),location:i("placeholder.inputText"),name:i("placeholder.inputText"),wide:i("placeholder.inputText")},{handleSubmit:be,setFieldValue:y}=Ke({validationSchema:Qe(fe)}),J=u([{id:"sale",name:i("messages.service_sale")},{id:"rent",name:i("messages.service_rent")}]),we=u([{id:"air",name:i("messages.air")},{id:"fan",name:i("messages.fan")},{id:"no",name:i("messages.none")}]),X=u([{id:"sale",name:i("messages.service_sale")},{id:"day",name:i("messages.service_daily")},{id:"month",name:i("messages.service_monthly")},{id:"year",name:i("messages.service_yearly")}]),O=u(!1),N=u(),D=u();Re(async()=>{await L()});const L=async()=>{const e=Number(_.params.id);m.btnLoading=!0,await de(e),await $e(),m.btnLoading=!1,s.service_model==="rent"?(O.value=!0,N.value=X.value.slice(1,4),D.value=J.value.splice(1,1)):(O.value=!1,N.value=X.value.slice(0,1),D.value=J.value.splice(0,1))},$e=async()=>{const e=ce.data.props;y("village",e.village),y("agent_name",e.agent_name),y("owner_name",e.owner_name),y("build_in",e.build_in),y("wide",e.wide),y("long",e.long),y("location",e.location),y("name",e.name),y("bed",e.total_bed),y("bath",e.total_bath),y("garage",e.garage),s.room_type=e.room_type,s.service_model=e.service_model,s.remark=e.remark,s.prices=e.price,C.value=e.image,K.value=e.gallery,await he(),s.real_estate_type_id=e.real_estate_type?e.real_estate_type.id:void 0,s.province_id=e.province?e.province.id:void 0},Z=be(async e=>{s.id=String(_.params.id),s.village=e.village,s.name=e.name,s.agent_name=e.agent_name,s.owner_name=e.owner_name,s.build_in=e.build_in,s.wide=e.wide,s.long=e.long,s.total_bed=e.bed,s.total_bath=e.bath,s.garage=e.garage,s.name=e.name,s.remark=e.remark,s.location=e.location,s.image=S.value,await re(),m.error?await G():(await M(),await L(),await B())}),Se=()=>{document.getElementById("fileInput").click()},Ve=async e=>{var d;const o=e.target,l=(d=o.files)==null?void 0:d[0];if(l){if(!await oe(l)){await R({toast:h,error:"error",summary:i("toast.summary.error"),detail:i("toast.summary.real_estate_profile_valid_file_mimes")}),o.value="",S.value="";return}if(!await ie(l)){await R({toast:h,error:"error",summary:i("toast.summary.error"),detail:i("toast.summary.real_estate_profile_valid_file_size")}),o.value="",S.value="";return}const n=new Image;n.src=URL.createObjectURL(l),n.onload=async()=>{const c=n.width,w=n.height;c>A.value||w>x.value?(S.value="",o.value="",await ae(i("messages.dimensions"))):(await le(l,"image"),await Z())}}},ee=(e,o)=>{s.id=e,Q.value=o,Q.value==="update"?(document.getElementById("updateGalleryInput").click(),V.value=[]):(document.getElementById("addGalleryInput").click(),V.value=[])},ke=async e=>{await me(e),m.error?await G():(await M(),await L(),await B())},Te=async e=>{var d;const o=e.target,l=(d=o.files)==null?void 0:d[0];if(l){if(!await oe(l)){await R({toast:h,error:"error",summary:i("toast.summary.error"),detail:i("toast.summary.real_estate_profile_valid_file_mimes")}),o.value="",C.value="",S.value="";return}if(!await ie(l)){await R({toast:h,error:"error",summary:i("toast.summary.error"),detail:i("toast.summary.real_estate_profile_valid_file_size")}),o.value="",C.value="",S.value="";return}const n=new Image;n.src=URL.createObjectURL(l),n.onload=async()=>{const c=n.width,w=n.height;c>A.value||w>x.value?(T.value="",o.value="",await ae(i("messages.dimensions"))):(await le(l,"gallery"),s.gallery=T.value,await ue(),m.error?await G():(await M(),await L(),await B()))}}},V=u([]),A=u(2e3),x=u(1900),Ie=async e=>{const o=e.target,l=o.files,d=1*1024*1024,n=5*1024*1024;if(l){let c=0;for(let w=0;w<l.length;w++){const q=l[w];c+=q.size;try{await Ce(q,d)}catch(Fe){V.value.push(Fe)}}if(c>n){V.value.push(i("toast.summary.maximum_allowed_size_5MB")),o.value="";return}V.value.length<=0?(await Le(l),s.gallery=T.value,await pe(),m.error?await G():(await M(),await L(),await B())):o.value=""}},Ce=(e,o)=>new Promise((l,d)=>{if(e.size>o)d(`${e.name} => `+i("toast.summary.real_estate_profile_valid_file_size_1MB"));else if(!["image/jpeg","image/jpg"].includes(e.type))d(`${e.name} => `+i("toast.summary.real_estate_profile_valid_file_mimes"));else{const c=new Image;c.src=URL.createObjectURL(e),c.onload=()=>{const w=c.width,q=c.height;w>A.value||q>x.value?d(`${e.name} => `+i("messages.dimensions")):l("")},c.onerror=()=>{d(`Error loading image ${e.name}.`)}}}),ae=e=>{h.add({severity:"error",summary:i("toast.summary.error"),detail:e,life:3e3})},G=()=>{h.add({severity:"error",summary:i("toast.summary.error"),detail:`${m.error}`,life:3e3})},B=()=>{h.add({severity:"success",summary:i("toast.summary.success"),detail:i("toast.detail.successfully"),life:3e3})},M=async()=>{C.value="",S.value="",T.value="";const e=document.getElementById("fileInput");e.value="";const o=document.getElementById("updateGalleryInput");o.value="";const l=document.getElementById("addGalleryInput");l.value=""},Le=async e=>{m.btnLoading=!0;try{let o=new FormData;for(let n=0;n<e.length;n++)o.append("files[]",e[n]);const d=(await te.post("https://api.hellonewyears.com/api/upload/multiple/files",o,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${Y}`}})).data.filename.map(n=>({image:`${n}`}));T.value=d,m.btnLoading=!1}catch(o){console.error("Upload failed:",o)}},le=async(e,o)=>{var l,d;m.btnLoading=!0;try{let n=new FormData;n.append("file",e);const c=await te.post("https://api.hellonewyears.com/api/upload_file",n,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${Y}`}});o==="image"?S.value=(l=c.data)==null?void 0:l.filename:T.value=(d=c.data)==null?void 0:d.filename,m.btnLoading=!1}catch(n){console.error("Upload failed:",n)}};return(e,o)=>(v(),g("div",ta,[a("div",oa,[a("span",ia,[a("h2",{style:{"font-weight":"bold","font-size":"20px"},class:"arrow-left",onClick:o[0]||(o[0]=l=>ge())},[na,$(" "+p(e.$t("messages.form_register")),1)])])]),ra,r(t(W)),a("form",{onSubmit:o[5]||(o[5]=Oe(l=>t(Z)(),["prevent"])),class:"flex flex-column gap-3 h-full"},[a("div",da,[a("div",ca,[a("label",null,[$(p(e.$t("messages.realestate_type"))+" ",1),ma]),r(t(z),{name:"real_estate_type",style:{"margin-top":"8px"},modelValue:t(s).real_estate_type_id,"onUpdate:modelValue":o[1]||(o[1]=l=>t(s).real_estate_type_id=l),options:t(_e).props,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0},null,8,["modelValue","options","placeholder"])]),a("div",ua,[a("label",null,[$(p(e.$t("messages.service_model"))+" ",1),pa]),r(t(z),{style:{"margin-top":"8px"},modelValue:t(s).service_model,"onUpdate:modelValue":o[2]||(o[2]=l=>t(s).service_model=l),options:D.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),optionValue:"id",highlightOnSelect:!0,class:"w-full"},null,8,["modelValue","options","placeholder"])]),a("div",ha,[a("label",null,[$(p(e.$t("messages.room_type"))+" ",1),_a]),r(t(z),{style:{"margin-top":"8px"},modelValue:t(s).room_type,"onUpdate:modelValue":o[3]||(o[3]=l=>t(s).room_type=l),options:we.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0},null,8,["modelValue","options","placeholder"])]),a("div",ga,[r(f,{name:"name",label:e.$t("messages.real_estate_name"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",va,[r(f,{name:"agent_name",label:e.$t("messages.name"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",ya,[r(f,{name:"owner_name",label:e.$t("messages.owner"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",fa,[r(f,{name:"village",label:e.$t("messages.address"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).village},null,8,["label","placeholder","value"])]),a("div",ba,[r(f,{name:"bed",label:e.$t("messages.total_bed"),placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",wa,[r(f,{name:"bath",label:e.$t("messages.total_bath"),placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",$a,[r(f,{name:"long",label:e.$t("messages.long"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).long},null,8,["label","placeholder","value"])]),a("div",Sa,[r(f,{name:"wide",label:e.$t("messages.wide"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).wide},null,8,["label","placeholder","value"])]),a("div",Va,[r(f,{name:"build_in",label:e.$t("messages.build_in"),required:"",placeholder:e.$t("placeholder.build_in"),class:"h-full"},null,8,["label","placeholder"])]),a("div",ka,[r(f,{name:"garage",label:e.$t("messages.garage"),required:"",placeholder:e.$t("placeholder.inputTextGarage"),class:"h-full"},null,8,["label","placeholder"])]),a("div",Ta,[r(f,{name:"location",label:e.$t("messages.location"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).location},null,8,["label","placeholder","value"])]),a("div",Ia,[r(sa,{name:"remark",label:e.$t("messages.details"),required:"",placeholder:e.$t("placeholder.inputTextDetails"),class:"h-full",value:t(s).remark},null,8,["label","placeholder","value"])]),a("div",Ca,[r(t(H),{header:e.$t("messages.setting_price_for_rent")},{default:F(()=>[(v(!0),g(P,null,j(t(s).prices,(l,d)=>(v(),g("div",{class:"columns is-12",key:d},[a("div",La,[a("label",null,[$(p(e.$t("messages.service_model"))+" ",1),Fa]),r(t(z),{modelValue:l.unit_price,"onUpdate:modelValue":n=>l.unit_price=n,options:N.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0,required:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),a("div",Ua,[a("label",null,[$(p(e.$t("messages.price"))+" ",1),Ea]),r(t(se),{modelValue:l.price,"onUpdate:modelValue":n=>l.price=n,placeholder:e.$t("placeholder.inputText"),required:"",style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'",width:"100% !important"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),t(s).service_model==="rent"?(v(),g("div",Ga,[a("label",null,p(e.$t("messages.details")),1),Ae(a("input",{name:"detail",type:"text",class:"input","onUpdate:modelValue":n=>l.detail=n,placeholder:e.$t("placeholder.inputText"),style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"}},null,8,Ba),[[xe,l.detail]])])):U("",!0),t(s).service_model==="sale"?(v(),g("div",Ma,[a("label",null,p(e.$t("messages.est_m")),1),r(t(se),{modelValue:l.est_m,"onUpdate:modelValue":n=>l.est_m=n,placeholder:e.$t("placeholder.inputText"),required:"",style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'",width:"100% !important"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):U("",!0),a("div",qa,[d>0?(v(),g("a",{key:0,onClick:n=>ye(d),class:"button is-danger remove-btn",style:{"margin-top":"22px"}},Oa,8,za)):U("",!0)])]))),128)),a("div",Na,[r(t(I),{onClick:ve,class:"button is-info",disabled:!O.value,style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"}},{default:F(()=>[$(p(e.$t("button.add_item")),1)]),_:1},8,["disabled"])])]),_:1},8,["header"])]),a("div",Da,[r(t(H),{header:e.$t("messages.profile")},{default:F(()=>[a("div",Aa,[a("div",xa,[a("div",Pa,[a("div",ja,[a("figure",Ha,[a("img",{src:C.value,alt:"Placeholder image"},null,8,Wa)])]),a("div",Ka,[a("span",Qa,[r(t(I),{icon:"pi pi-pencil",severity:"warning",rounded:"",onClick:Se,style:{color:"white"}}),a("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:Ve},null,32)])])])])])]),_:1},8,["header"])]),a("div",Ya,[r(t(H),{header:e.$t("messages.profile_and_gallery")},{default:F(()=>[a("div",Ja,[(v(!0),g(P,null,j(K.value,(l,d)=>(v(),g("div",{class:"column is-mobile-12 is-3",key:d},[a("div",Xa,[a("div",Za,[a("figure",el,[a("img",{src:l==null?void 0:l.image,alt:"Placeholder image"},null,8,al)])]),a("div",ll,[a("span",sl,[r(t(I),{icon:"pi pi-trash",severity:"danger",rounded:"",onClick:n=>ke(l.id)},null,8,["onClick"]),tl,r(t(I),{icon:"pi pi-pencil",severity:"warning",rounded:"",onClick:n=>ee(l.id,"update"),style:{color:"white"}},null,8,["onClick"])]),a("input",{type:"file",id:"updateGalleryInput",style:{display:"none"},onChange:Te},null,32),a("input",{type:"file",id:"addGalleryInput",multiple:"",style:{display:"none"},onChange:Ie},null,32)])])]))),128)),r(t(W)),a("div",ol,[r(t(I),{icon:"pi pi-plus-circle",onClick:o[4]||(o[4]=l=>ee(t(_).params.id,"add"))})]),r(t(W)),V.value.length>0?(v(),g("div",il,[(v(!0),g(P,null,j(V.value,(l,d)=>(v(),g("p",{style:{color:"red"},key:d},p(d+1)+". "+p(l),1))),128))])):U("",!0)])]),_:1},8,["header"])]),a("div",nl,[r(t(I),{style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"},type:"submit",severity:"info",loading:t(m).btnLoading,disabled:t(Xe)(t(Pe).REAL_ESTATE.UPDATE)},{default:F(()=>[rl,$(" "+p(e.$t("button.edit_data")),1)]),_:1},8,["loading","disabled"])])])],32)]))}}),Cl=je(dl,[["__scopeId","data-v-a4a56876"]]);export{Cl as default};
