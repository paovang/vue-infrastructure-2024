import{i as _,a as m,A as g,b as h}from"./axios.config-Z5iSjdte.js";import{I as d,a as P,J as v}from"./index-6RafQ1sh.js";var w=Object.defineProperty,O=Object.getOwnPropertyDescriptor,j=(e,a,r,t)=>{for(var s=t>1?void 0:t?O(a,r):a,o=e.length-1,n;o>=0;o--)(n=e[o])&&(s=(t?n(a,r,s):n(s))||s);return t&&s&&w(a,r,s),s},$=(e,a)=>(r,t)=>a(r,t,e);let l=class{constructor(e){this._api=e}async login(e){return{data:(await this._api.axios({method:"post",url:"/auth/login",params:{email:e.email,password:e.password}})).data,message:"ເຂົ້າສູ່ລະບົບສຳເລັດ.",status:"success"}}};l=j([_(),$(0,m(g))],l);var b=Object.defineProperty,S=Object.getOwnPropertyDescriptor,A=(e,a,r,t)=>{for(var s=t>1?void 0:t?S(a,r):a,o=e.length-1,n;o>=0;o--)(n=e[o])&&(s=(t?n(a,r,s):n(s))||s);return t&&s&&b(a,r,s),s},y=(e,a)=>(r,t)=>a(r,t,e);let u=class{constructor(e){this._api=e}async execute(e){return await this._api.login(e)}};u=A([_(),y(0,m(l))],u);var D=Object.defineProperty,x=Object.getOwnPropertyDescriptor,I=(e,a,r,t)=>{for(var s=t>1?void 0:t?x(a,r):a,o=e.length-1,n;o>=0;o--)(n=e[o])&&(s=(t?n(a,r,s):n(s))||s);return t&&s&&D(a,r,s),s},U=(e,a)=>(r,t)=>a(r,t,e);let p=class{constructor(e){this._login=e}async login(e){return await this._login.execute(e)}};p=I([_(),U(0,m(u))],p);const M=d("auth",()=>{const e=P(),a=h.resolve(p),r=v({data:null,isLoading:!1,errorMessage:""}),t=v({email:"",password:""});async function s(n){r.isLoading=!0;try{const i=await a.login(n);if(i.status==="success"&&i.data){localStorage.setItem("token",i.data.access_token),localStorage.setItem("roles",i.data.authUser.role),r.errorMessage="";const c=i.data.authUser.role;c.includes("SuperAdmin","User")?e.push({name:"customer"}):c.includes("Admin")&&e.push({name:"owner.house"})}else r.errorMessage=i.message?i.message:""}catch(i){let c="";i.response.status===422?c=Object.keys(i.response.data.errors).map(f=>`${f}: ${i.response.data.errors[f].join(", ")}`).join("; "):i.response.status===401?c="ອີເມວ ຫຼື ລະຫັດຜ່ານບໍ່ຖືກຕ້ອງ.":c=i.response.data.error,r.errorMessage=c}r.isLoading=!1}async function o(){localStorage.removeItem("token"),localStorage.removeItem("roles"),e.push({name:"login"})}return{state:r,form:t,login:s,logout:o}});export{M as u};
