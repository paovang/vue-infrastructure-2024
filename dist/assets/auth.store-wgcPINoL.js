import{V as v,a as d,W as h,G as c}from"./index-ZqsaGH-o.js";import{i as m,b as f,A as w,c as O}from"./axios.config-jCy-uYyV.js";var S=Object.defineProperty,P=Object.getOwnPropertyDescriptor,j=(e,a,r,t)=>{for(var s=t>1?void 0:t?P(a,r):a,n=e.length-1,i;n>=0;n--)(i=e[n])&&(s=(t?i(a,r,s):i(s))||s);return t&&s&&S(a,r,s),s},b=(e,a)=>(r,t)=>a(r,t,e);let u=class{constructor(e){this._api=e}async login(e){return{data:(await this._api.axios({method:"post",url:"/auth/login",params:{email:e.email,password:e.password}})).data,message:"ເຂົ້າສູ່ລະບົບສຳເລັດ.",status:"success"}}};u=j([m(),b(0,f(w))],u);var E=Object.defineProperty,I=Object.getOwnPropertyDescriptor,$=(e,a,r,t)=>{for(var s=t>1?void 0:t?I(a,r):a,n=e.length-1,i;n>=0;n--)(i=e[n])&&(s=(t?i(a,r,s):i(s))||s);return t&&s&&E(a,r,s),s},y=(e,a)=>(r,t)=>a(r,t,e);let p=class{constructor(e){this._api=e}async execute(e){return await this._api.login(e)}};p=$([m(),y(0,f(u))],p);var A=Object.defineProperty,D=Object.getOwnPropertyDescriptor,R=(e,a,r,t)=>{for(var s=t>1?void 0:t?D(a,r):a,n=e.length-1,i;n>=0;n--)(i=e[n])&&(s=(t?i(a,r,s):i(s))||s);return t&&s&&A(a,r,s),s},U=(e,a)=>(r,t)=>a(r,t,e);let _=class{constructor(e){this._login=e}async login(e){return await this._login.execute(e)}};_=R([m(),U(0,f(p))],_);const x=v("auth",()=>{const e=d(),a=O.resolve(_),r=h({data:null,isLoading:!1,errorMessage:""}),t=h({email:"",password:""});async function s(i){r.isLoading=!0;try{const o=await a.login(i);if(o.status==="success"&&o.data){localStorage.setItem("token",o.data.access_token),localStorage.setItem("roles",JSON.stringify(o.data.authUser.roles)),localStorage.setItem("permissions",JSON.stringify(o.data.authUser.permissions)),localStorage.setItem("locale","en"),r.errorMessage="";const l=o.data.authUser.roles;l.includes(c.SUPER_ADMIN)||l.includes(c.ADMIN)||l.includes(c.USER)?(e.push({name:"dashboard"}),e.afterEach(()=>{window.location.reload()})):(l.includes(c.ADMIN_OWNER)||l.includes(c.USER_OWNER))&&(e.push({name:"owner.house"}),e.afterEach(()=>{window.location.reload()}))}else r.errorMessage=o.message?o.message:""}catch(o){let l="";o.response.status===422?l=Object.keys(o.response.data.errors).map(g=>`${g}: ${o.response.data.errors[g].join(", ")}`).join("; "):o.response.status===401?l="ອີເມວ ຫຼື ລະຫັດຜ່ານບໍ່ຖືກຕ້ອງ.":l=o.response.data.error,r.errorMessage=l}r.isLoading=!1}async function n(){localStorage.removeItem("token"),localStorage.removeItem("roles"),localStorage.removeItem("permissions"),e.push({name:"home"})}return{state:r,form:t,login:s,logout:n}});export{x as u};
