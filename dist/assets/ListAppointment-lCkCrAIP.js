import{d as x,u as q,M as B,r as v,l as M,E as f,g as a,j as F,f as l,y as s,U as N,V as j,a0 as I,H as O,a as z,P as T,o as A,e as D,t as h,W as E,Q as H,J as K}from"./index-1rBvGq5i.js";import{a as U}from"./appointment.store-pcnDCpCj.js";import{s as r,a as W}from"./column.esm-pQJpB4kL.js";import{b as J}from"./calendar.esm-2Ij4oAlq.js";import{s as Q}from"./dropdown.esm-7TkGAlXr.js";import{s as G}from"./inputtext.esm-1aq68lsP.js";import{_ as X}from"./FormTextArea.vue_vue_type_script_setup_true_lang-PC_UpMog.js";import{c as Y,a as Z,u as ee}from"./index.esm-blvxv04Q.js";import"./axios.config-HGXv1ygo.js";import"./format.date--bimoUa2.js";import"./paginator.esm-2Wfcy1f2.js";import"./inputnumber.esm-OwUBLcHF.js";import"./overlayeventbus.esm-Q6WBJ3w4.js";import"./index.esm-nG7VEzd6.js";import"./checkbox.esm-7QNZJm56.js";import"./index.esm-acoo5T1v.js";import"./textarea.esm-SQe-9VQC.js";const te=g=>Y({reason:Z().required(g.reason)}),ae=te,se={class:"flex flex-column align-items-center justify-content-center"},le={class:"col-12 md:col-12"},oe={class:"flex flex-column"},ne={class:"col-12 md:col-12"},ie={class:"flex flex-column"},re=x({__name:"Update.Component",props:{id:{}},emits:["onSuccess","onHide"],setup(g,{expose:i,emit:c}){const{t}=q(),u=B(),d=v(!1);i({visible:d});const y=c,S=v(!1),b=g,k={reason:t("placeholder.inputText")},{form:p,update:P,state:w}=U(),{handleSubmit:$,handleReset:V}=ee({validationSchema:ae(k)}),C=$(async m=>{p.id=b.id,p.reason=m.reason,await P(),w.error?await L():(await _(),await R(),d.value=!1)}),_=async()=>{await V(),y("onSuccess")},L=()=>{u.add({severity:"error",summary:t("toast.summary.error"),detail:`${w.error}`,life:3e3})},R=()=>{u.add({severity:"success",summary:t("toast.summary.success"),detail:t("toast.detail.successfully"),life:3e3})};return(m,e)=>(F(),M(a(I),{visible:d.value,"onUpdate:visible":e[1]||(e[1]=o=>d.value=o),modal:"",onHide:_,header:m.$t("messages.update_appointment"),style:{width:"50vw"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:f(()=>[l("form",{onSubmit:e[0]||(e[0]=j(o=>a(C)(),["prevent"])),class:"flex flex-column gap-3 h-full"},[l("div",se,[l("div",le,[l("div",oe,[s(X,{name:"reason",label:m.$t("messages.reason"),required:"",placeholder:m.$t("placeholder.inputText")},null,8,["label","placeholder"])])])]),l("div",ne,[l("div",ie,[s(a(N),{type:"submit",severity:"danger",label:m.$t("button.update")+" "+m.$t("button.appointment"),loading:S.value},null,8,["label","loading"])])])],32)]),_:1},8,["visible","header"]))}}),de={class:"card"},me={class:"flex flex-wrap gap-2 align-items-center justify-content-between"},pe={class:"p-input-icon-left w-full sm:w-20rem flex-order-1 sm:flex-order-0"},ce={class:"mb-3"},ue={class:"col-12 md:col-12 flex flex-row",style:{"margin-top":"-15px"}},he={class:"col-12 md:col-5"},fe={class:"p-input-icon-left w-full flex-order-1 sm:flex-order-0"},ge=l("i",{class:"pi pi-search",style:{"margin-top":"-10px"}},null,-1),ye={class:"col-12 md:col-3"},be={class:"col-12 md:col-3"},we={class:"col-12 md:col-1",style:{"text-align":"right"}},$e={class:"flex flex-wrap gap-2 btn-right"},Ie=x({__name:"ListAppointment",setup(g){const{form:i,getAll:c,setStateFilter:t,state:u}=U(),{query:d}=O(),y=z(),S=v([{id:"all",name:"ທັງໝົດ"},{id:"pending",name:"ລໍຖ້າ"},{id:"done",name:"ສຳເລັດ"},{id:"cancel",name:"ຍົກເລີກ"}]),b=v(),k=async()=>{var e;i.status="all",i.date_appointment="",((e=t.filter)==null?void 0:e.name)!==void 0&&(t.filter.name=""),await p()},p=async()=>{t.filter&&(t.filter.status=i.status==="all"?"":i.status,t.filter.date_appointment=i.date_appointment),await c()},P=e=>e==="done"?"green":e==="cancel"?"red":"";async function w(e){var o;e.target.value===""&&(((o=t.filter)==null?void 0:o.name)!==void 0&&(t.filter.name=""),await c())}const $=T({get:()=>t.filter.name||"",set:e=>{t.filter?t.filter.name=e:t.filter={name:e}}}),V=async(e,o)=>{o!=="done"&&(i.id=e,b.value.visible=!0)},C=async()=>{await m()};async function _(e){t.page=e.page+1,t.limit=e.rows;const{page:o,limit:n}=t;y.push({name:"owner.appointment",query:{page:o,limit:n}}),await c()}const L=T(()=>{let e=0;return t.page&&t.limit&&(e=(t.page-1)*t.limit),e});async function R(){Object.keys(d).length!==0&&(t.page=d.page?Number(d.page):1,t.limit=d.limit?Number(d.limit):10,y.push({query:{page:t.page,limit:t.limit}})),await m()}const m=async()=>{await c(),i.status="pending"};return A(async()=>{t.filter&&(t.filter.status="pending",t.page=1,t.limit=10),await R()}),(e,o)=>(F(),D("div",de,[l("div",me,[l("span",pe,[l("h2",ce,h(e.$t("table.title.appointment")),1)])]),s(a(W),{value:a(u).data.props,onPage:_,paginator:"",first:L.value,rowsPerPageOptions:[5,10,20,50],tableStyle:"min-width: 50rem",loading:a(u).isLoading,lazy:"",scrollable:"",totalRecords:a(u).data.total,rows:a(t).limit,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:`${e.$t("table.pagination.show")} {first} ${e.$t("table.pagination.to")} {last} ${e.$t("table.pagination.from")} {totalRecords} ${e.$t("table.pagination.row")}`},{header:f(()=>[l("div",ue,[l("div",he,[l("label",null,h(e.$t("messages.search")),1),l("span",fe,[ge,s(a(G),{modelValue:$.value,"onUpdate:modelValue":o[0]||(o[0]=n=>$.value=n),placeholder:`${e.$t("placeholder.textSearch")} (${e.$t("messages.reserve_number")}, ${e.$t("messages.real_esate_number")}, ${e.$t("messages.service_model")})`,style:{"font-family":"NotoSansLao, Montserrat"},class:"w-full",onKeyup:E(p,["enter"]),onInput:w},null,8,["modelValue","placeholder"])])]),l("div",ye,[l("label",null,h(e.$t("messages.status")),1),s(a(Q),{name:"real_estate_type",modelValue:a(i).status,"onUpdate:modelValue":o[1]||(o[1]=n=>a(i).status=n),options:S.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0,onChange:p},null,8,["modelValue","options","placeholder"])]),l("div",be,[l("label",null,h(e.$t("messages.date_appointment")),1),s(a(J),{modelValue:a(i).date_appointment,"onUpdate:modelValue":o[2]||(o[2]=n=>a(i).date_appointment=n),showIcon:"",style:{width:"100%"},onDateSelect:p,onInput:p},null,8,["modelValue"])]),l("div",we,[s(a(N),{icon:"pi pi-refresh",severity:"warning",style:{"margin-top":"22px !important",color:"white"},onClick:k})])])]),default:f(()=>[s(a(r),{frozen:""},{body:f(({data:n})=>[l("div",$e,[s(a(N),{type:"button",icon:"pi pi-pencil",rounded:"",severity:"danger",style:{color:"white"},disabled:n.status==="done",onClick:_e=>V(n.id,n.status)},null,8,["disabled","onClick"])])]),_:1}),s(a(r),{field:"id",header:e.$t("table.header.index")},{body:f(n=>[H(h(n.index+1),1)]),_:1},8,["header"]),s(a(r),{field:"date_appointment",header:e.$t("table.header.date_appointment"),headerStyle:"min-width: 10rem"},null,8,["header"]),s(a(r),{field:"reserve_number",header:e.$t("table.header.reserve_number"),headerStyle:"min-width: 8rem"},null,8,["header"]),s(a(r),{field:"customer_name",header:e.$t("table.header.customer_name"),headerStyle:"min-width: 8rem"},null,8,["header"]),s(a(r),{field:"customer_tel",header:e.$t("table.header.customer_phone"),headerStyle:"min-width: 8rem"},null,8,["header"]),s(a(r),{field:"estate_list.real_esate_number",header:e.$t("table.header.real_esate_number"),headerStyle:"min-width: 8rem"},null,8,["header"]),s(a(r),{field:"estate_list.name",header:e.$t("table.header.name"),headerStyle:"min-width: 8rem"},null,8,["header"]),s(a(r),{field:"estate_list.service_model",header:e.$t("table.header.service_model"),headerStyle:"min-width: 8rem"},null,8,["header"]),s(a(r),{field:"estate_list.room_type",header:e.$t("table.header.room_type"),headerStyle:"min-width: 7rem"},null,8,["header"]),s(a(r),{field:"reason",header:e.$t("table.header.reason"),headerStyle:"min-width: 8rem"},null,8,["header"]),s(a(r),{field:"status",header:e.$t("table.header.status"),headerStyle:"min-width: 8rem"},{body:f(n=>[l("span",{style:K({color:P(n.data.status)})},h(n.data.status),5)]),_:1},8,["header"])]),_:1},8,["value","first","loading","totalRecords","rows","currentPageReportTemplate"]),s(re,{ref_key:"editForm",ref:b,id:a(i).id,onOnSuccess:C},null,8,["id"])]))}});export{Ie as default};
