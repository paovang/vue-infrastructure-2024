import{J as h,a as d,K as g,G as l}from"./index-EZFKjDzF.js";import{i as f,a as m,A as O,b as P}from"./axios.config-0T_DZnyO.js";var w=Object.defineProperty,S=Object.getOwnPropertyDescriptor,j=(e,a,r,t)=>{for(var s=t>1?void 0:t?S(a,r):a,o=e.length-1,n;o>=0;o--)(n=e[o])&&(s=(t?n(a,r,s):n(s))||s);return t&&s&&w(a,r,s),s},$=(e,a)=>(r,t)=>a(r,t,e);let u=class{constructor(e){this._api=e}async login(e){return{data:(await this._api.axios({method:"post",url:"/auth/login",params:{email:e.email,password:e.password}})).data,message:"ເຂົ້າສູ່ລະບົບສຳເລັດ.",status:"success"}}};u=j([f(),$(0,m(O))],u);var b=Object.defineProperty,A=Object.getOwnPropertyDescriptor,D=(e,a,r,t)=>{for(var s=t>1?void 0:t?A(a,r):a,o=e.length-1,n;o>=0;o--)(n=e[o])&&(s=(t?n(a,r,s):n(s))||s);return t&&s&&b(a,r,s),s},E=(e,a)=>(r,t)=>a(r,t,e);let p=class{constructor(e){this._api=e}async execute(e){return await this._api.login(e)}};p=D([f(),E(0,m(u))],p);var R=Object.defineProperty,y=Object.getOwnPropertyDescriptor,I=(e,a,r,t)=>{for(var s=t>1?void 0:t?y(a,r):a,o=e.length-1,n;o>=0;o--)(n=e[o])&&(s=(t?n(a,r,s):n(s))||s);return t&&s&&R(a,r,s),s},M=(e,a)=>(r,t)=>a(r,t,e);let _=class{constructor(e){this._login=e}async login(e){return await this._login.execute(e)}};_=I([f(),M(0,m(p))],_);const L=h("auth",()=>{const e=d(),a=P.resolve(_),r=g({data:null,isLoading:!1,errorMessage:""}),t=g({email:"",password:""});async function s(n){r.isLoading=!0;try{const c=await a.login(n);if(c.status==="success"&&c.data){localStorage.setItem("token",c.data.access_token),localStorage.setItem("roles",c.data.authUser.role),r.errorMessage="";const i=c.data.authUser.role;i.includes(l.SUPER_ADMIN)||i.includes(l.ADMIN)||i.includes(l.USER)?e.push({name:"customer"}):(i.includes(l.ADMIN_OWNER)||i.includes(l.USER_OWNER))&&e.push({name:"owner.house"})}else r.errorMessage=c.message?c.message:""}catch(c){let i="";c.response.status===422?i=Object.keys(c.response.data.errors).map(v=>`${v}: ${c.response.data.errors[v].join(", ")}`).join("; "):c.response.status===401?i="ອີເມວ ຫຼື ລະຫັດຜ່ານບໍ່ຖືກຕ້ອງ.":i=c.response.data.error,r.errorMessage=i}r.isLoading=!1}async function o(){localStorage.removeItem("token"),localStorage.removeItem("roles"),e.push({name:"login"})}return{state:r,form:t,login:s,logout:o}});export{L as u};
