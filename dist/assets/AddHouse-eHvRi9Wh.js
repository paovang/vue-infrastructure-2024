import{d as $e,u as Se,M as Ve,N as ke,a as Te,r as u,o as Fe,e as p,f as l,K as y,t as c,y as i,g as n,E as U,U as Ie,p as Le,k as Ce,j as h,F as G,i as O,w as Ee,a3 as Ue,h as M,Q as j,J as x,b as Me,_ as qe}from"./index-8ojs7Ets.js";import{_}from"./FormInputText.vue_vue_type_script_setup_true_lang-SalVdA92.js";import{_ as ze}from"./FormTextArea.vue_vue_type_script_setup_true_lang-W84sTlX6.js";import{s as q}from"./dropdown.esm-uqjqw02i.js";import{s as P}from"./inputnumber.esm-E6GZnduC.js";import{u as Be}from"./vee-validate.esm-0shw6Keg.js";import{h as De,s as H}from"./panel.esm-5NkuwlGE.js";import{a as W}from"./axios.config-EMV3l8KB.js";import{s as J}from"./divider.esm-1GIG4_0w.js";import{r as Ne}from"./real-estate-service.store-MRzTUfsH.js";import{h as Ae}from"./house.store-_8_1mmbo.js";import{a as Re,s as K,i as Ge}from"./toast-FY7odgkM.js";import{v as Oe}from"./validation-permissions-u0zb2Lbk.js";import"./inputtext.esm-goY0yw6I.js";import"./textarea.esm-44DYpUwH.js";import"./overlayeventbus.esm-3Jt3uc49.js";import"./index.esm-PffGQ9Hs.js";import"./index.esm-Msd0ymxV.js";import"./index.esm-iwN5sOca.js";const g=I=>(Le("data-v-306c3033"),I=I(),Ce(),I),je={class:"card"},xe={class:"flex flex-wrap gap-2 align-items-center justify-content-between"},Pe={class:"p-input-icon-left w-full sm:w-20rem flex-order-1 sm:flex-order-0"},He=g(()=>l("i",{class:"pi pi-arrow-left",style:{color:"green"}},null,-1)),We=g(()=>l("br",null,null,-1)),Je={class:"columns is-12 is-multiline",style:{"margin-top":"20px"}},Ke={class:"column is-mobile-12 is-2"},Qe=g(()=>l("span",{class:"text-red-500"}," *",-1)),Xe={class:"column is-mobile-12 is-2"},Ye=g(()=>l("span",{class:"text-red-500"}," *",-1)),Ze={class:"column is-mobile-12 is-2"},el=g(()=>l("span",{class:"text-red-500"}," *",-1)),ll={class:"column is-mobile-12 is-2"},al={class:"column is-mobile-12 is-2"},sl={class:"column is-mobile-12 is-2"},tl={class:"column is-mobile-12 is-4 set-margin-top"},ol={class:"column is-mobile-12 is-2 set-margin-top"},il={class:"column is-mobile-12 is-2 set-margin-top"},nl={class:"column is-mobile-12 is-2 set-margin-top"},rl={class:"column is-mobile-12 is-2 set-margin-top"},dl={class:"column is-mobile-12 is-2 set-margin-top"},cl={class:"column is-mobile-12 is-2 set-margin-top"},ml={class:"column is-mobile-12 is-8 set-margin-top"},ul={class:"column is-mobile-12 is-12 set-margin-top"},pl={class:"column is-12"},hl={class:"column is-3"},_l=g(()=>l("span",{class:"text-red-500"}," *",-1)),gl={class:"column is-3"},vl=g(()=>l("span",{class:"text-red-500"}," *",-1)),fl={key:0,class:"column is-5"},yl=["onUpdate:modelValue"],bl={key:1,class:"column is-5"},wl={class:"column is-1"},$l=["onClick"],Sl=g(()=>l("i",{class:"pi pi-times-circle"},null,-1)),Vl=[Sl],kl={class:"column is-mobile-12 is-12"},Tl={class:"column is-12"},Fl={class:"column is-mobile-12 is-12"},Il=g(()=>l("span",{class:"text-red-500"}," *",-1)),Ll={key:0},Cl={key:1,style:{color:"#029217"}},El={class:"column is-mobile-12 is-12"},Ul=g(()=>l("span",{class:"text-red-500"}," *",-1)),Ml={key:0},ql={key:1,style:{color:"#029217"}},zl={key:0,class:"column is-mobile-12 is-12"},Bl={class:"column is-mobile-12 is-12 text-right"},Dl=g(()=>l("i",{class:"pi pi-save",style:{"margin-right":"8px"}},null,-1)),Nl=$e({__name:"AddHouse",setup(I){const{t:a}=Se(),b=Ve(),Q=ke(),X=Te(),{form:o,state:$,register:Y}=Ae(),{getOne:Z,realestateType:z}=Ne(),w=u(null),v=u(),B=u(2e3),D=u(1900),ee=async()=>{X.push({name:"owner.house"})},le=()=>{document.getElementById("fileInput").click()},ae=async e=>{var d;const t=e.target,s=(d=t.files)==null?void 0:d[0];if(s){if(!await Re(s)){await K({toast:b,error:"error",summary:a("toast.summary.error"),detail:a("toast.summary.real_estate_profile_valid_file_mimes")}),t.value="",w.value="",S.value="";return}if(!await Ge(s)){await K({toast:b,error:"error",summary:a("toast.summary.error"),detail:a("toast.summary.real_estate_profile_valid_file_size")}),t.value="",w.value="",S.value="";return}const r=new Image;r.src=URL.createObjectURL(s),r.onload=async()=>{const f=r.width,V=r.height;f>B.value||V>D.value?(w.value="",S.value="",t.value="",await fe(a("messages.dimensions"))):(w.value=a("uploadFile.uploading"),await ge(s),w.value=a("uploadFile.upload_success"))}}},se=()=>{document.getElementById("galleryInput").click(),k.value=[]},k=u([]),te=async e=>{const t=e.target,s=t.files,d=1*1024*1024,r=5*1024*1024;if(s){let f=0;for(let V=0;V<s.length;V++){const E=s[V];f+=E.size;try{await oe(E,d)}catch(we){k.value.push(we)}}if(f>r){k.value.push(a("toast.summary.maximum_allowed_size_5MB")),v.value="",v.value="",t.value="";return}k.value.length<=0?(v.value=a("uploadFile.uploading")+s.length,await ve(s),v.value=a("uploadFile.upload_success")+"("+s.length+" "+a("uploadFile.file")+")"):(v.value="",v.value="",t.value="")}},oe=(e,t)=>new Promise((s,d)=>{if(e.size>t)d(`${e.name} => `+a("toast.summary.real_estate_profile_valid_file_size_1MB"));else if(!["image/jpeg","image/jpg"].includes(e.type))d(`${e.name} => `+a("toast.summary.real_estate_profile_valid_file_mimes"));else{const f=new Image;f.src=URL.createObjectURL(e),f.onload=()=>{const V=f.width,E=f.height;V>B.value||E>D.value?d(`${e.name} => `+a("messages.dimensions")):s("")},f.onerror=()=>{d(`Error loading image ${e.name}.`)}}}),m=u([{price:"",unit_price:"",detail:"",est_m:""}]),ie=async()=>{var e;m.value&&(((e=m.value)==null?void 0:e.length)>2?b.add({severity:"error",summary:a("toast.summary.must_be_length_three"),detail:a("toast.detail.cancel_delete"),life:3e3}):m.value.push({price:"",unit_price:"",detail:""}))},ne=async e=>{m.value&&m.value.splice(e,1)},F=u(!1),re=async e=>{e==="rent"?(F.value=!0,T.value=L.value.slice(1,4),m&&m.value&&(m.value[0].unit_price=T.value[0].id,m.value[0].est_m=0)):(F.value=!1,T.value=L.value.slice(0,1),m&&m.value&&(m.value[0].unit_price=T.value[0].id))},de={village:a("placeholder.inputText"),location:a("placeholder.inputText"),name:a("placeholder.inputText"),wide:a("placeholder.inputText")},{handleSubmit:ce}=Be({validationSchema:De(de)}),me=u([{id:"sale",name:a("messages.service_sale")},{id:"rent",name:a("messages.service_rent")}]),ue=u([{id:"air",name:a("messages.air")},{id:"fan",name:a("messages.fan")},{id:"no",name:a("messages.none")}]),L=u([{id:"sale",name:a("messages.service_sale")},{id:"day",name:a("messages.service_daily")},{id:"month",name:a("messages.service_monthly")},{id:"year",name:a("messages.service_yearly")}]),T=u(),N=localStorage.getItem("token"),C=u(),S=u();Fe(async()=>{await pe(),m&&m.value&&(m.value[0].unit_price=L.value[0].id),T.value=L.value.slice(0,1)});const pe=async()=>{o.room_type="air",o.service_model="sale",await Z(),o.real_estate_type_id=z.props.length>0?z.props[0].id:void 0},he=ce(async e=>{S.value?C.value?(o.village=e.village,o.agent_name=e.agent_name,o.owner_name=e.owner_name,o.build_in=e.build_in,o.wide=e.wide,o.long=e.long,o.total_bath=e.bath,o.total_bed=e.bed,o.garage=e.garage,o.name=e.name,o.remark=e.remark,o.location=e.location,o.prices=m.value,o.image=S.value,o.gallery=C.value,await Y(),$.error?await ye():await be()):await R(a("placeholder.dropdownSelect")+" "+a("messages.gallery")):await R(a("placeholder.dropdownSelect")+" "+a("messages.image"))}),_e=async()=>{w.value="",v.value="",S.value="",C.value="";const e=document.getElementById("fileInput");e.value="";const t=document.getElementById("galleryInput");t.value=""},ge=async e=>{var t;$.btnLoading=!0;try{let s=new FormData;s.append("file",e);const d=await W.post("https://api.hellonewyears.com/api/upload_file",s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${N}`}});S.value=(t=d.data)==null?void 0:t.filename,$.btnLoading=!1}catch(s){await A(s)}},ve=async e=>{$.btnLoading=!0;try{let t=new FormData;for(let r=0;r<e.length;r++)t.append("files[]",e[r]);const d=(await W.post("https://api.hellonewyears.com/api/upload/multiple/files",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${N}`}})).data.filename.map(r=>({image:`${r}`}));C.value=d,$.btnLoading=!1}catch(t){await A(t)}},A=e=>{b.add({severity:"error",summary:a("toast.summary.error"),detail:e,life:3e3})},fe=e=>{b.add({severity:"error",summary:a("toast.summary.error"),detail:e,life:3e3})},R=e=>{b.add({severity:"error",summary:a("toast.summary.error"),detail:e,life:3e3})},ye=()=>{b.add({severity:"error",summary:a("toast.summary.error"),detail:`${$.error}`,life:3e3})},be=async()=>{Q.require({message:a("confirmDuplicate.message"),header:a("confirmDuplicate.header"),rejectLabel:a("confirmDuplicate.rejectLabel"),acceptLabel:a("confirmDuplicate.acceptLabel"),rejectClass:"p-button-danger",acceptClass:"p-button-info",accept:async()=>{await _e(),b.add({severity:"success",summary:a("toast.summary.duplicate"),detail:a("toast.detail.success_duplicate"),life:3e3})},reject:async()=>{window.location.reload(),b.add({severity:"error",summary:a("toast.summary.not_duplicate"),detail:a("toast.detail.cancel_duplicate"),life:3e3})}})};return(e,t)=>(h(),p("div",je,[l("div",xe,[l("span",Pe,[l("h2",{style:{"font-weight":"bold","font-size":"20px"},class:"arrow-left",onClick:t[0]||(t[0]=s=>ee())},[He,y(" "+c(e.$t("messages.form_register")),1)])])]),We,i(n(J)),l("form",{onSubmit:t[5]||(t[5]=Ie(s=>n(he)(),["prevent"])),class:"flex flex-column gap-3 h-full"},[l("div",Je,[l("div",Ke,[l("label",null,[y(c(e.$t("messages.realestate_type"))+" ",1),Qe]),i(n(q),{name:"real_estate_type",style:{"margin-top":"8px"},modelValue:n(o).real_estate_type_id,"onUpdate:modelValue":t[1]||(t[1]=s=>n(o).real_estate_type_id=s),options:n(z).props,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0},null,8,["modelValue","options","placeholder"])]),l("div",Xe,[l("label",null,[y(c(e.$t("messages.service_model"))+" ",1),Ye]),i(n(q),{style:{"margin-top":"8px"},modelValue:n(o).service_model,"onUpdate:modelValue":t[2]||(t[2]=s=>n(o).service_model=s),options:me.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),optionValue:"id",highlightOnSelect:!0,class:"w-full",onChange:t[3]||(t[3]=s=>re(n(o).service_model))},null,8,["modelValue","options","placeholder"])]),l("div",Ze,[l("label",null,[y(c(e.$t("messages.room_type"))+" ",1),el]),i(n(q),{style:{"margin-top":"8px"},modelValue:n(o).room_type,"onUpdate:modelValue":t[4]||(t[4]=s=>n(o).room_type=s),options:ue.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0},null,8,["modelValue","options","placeholder"])]),l("div",ll,[i(_,{name:"name",label:e.$t("messages.real_estate_name"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),l("div",al,[i(_,{name:"agent_name",label:e.$t("messages.agent_name"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),l("div",sl,[i(_,{name:"owner_name",label:e.$t("messages.owner"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),l("div",tl,[i(_,{name:"village",label:e.$t("messages.address"),required:"",placeholder:e.$t("placeholder.inputTextAddress"),class:"h-full"},null,8,["label","placeholder"])]),l("div",ol,[i(_,{name:"bed",label:e.$t("messages.total_bed"),placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),l("div",il,[i(_,{name:"bath",label:e.$t("messages.total_bath"),placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),l("div",nl,[i(_,{name:"long",label:e.$t("messages.long"),placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),l("div",rl,[i(_,{name:"wide",label:e.$t("messages.wide"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),l("div",dl,[i(_,{name:"build_in",label:e.$t("messages.build_in"),required:"",placeholder:e.$t("placeholder.build_in"),class:"h-full"},null,8,["label","placeholder"])]),l("div",cl,[i(_,{name:"garage",label:e.$t("messages.garage"),required:"",placeholder:e.$t("placeholder.inputTextGarage"),class:"h-full"},null,8,["label","placeholder"])]),l("div",ml,[i(_,{name:"location",label:e.$t("messages.location"),required:"",placeholder:e.$t("placeholder.inputTextLocation"),class:"h-full"},null,8,["label","placeholder"])]),l("div",ul,[i(ze,{name:"remark",label:e.$t("messages.details"),required:"",placeholder:e.$t("placeholder.inputTextDetails"),class:"h-full"},null,8,["label","placeholder"])]),l("div",pl,[i(n(H),{header:e.$t("messages.setting_price_for_rent")},{default:U(()=>[(h(!0),p(G,null,O(m.value,(s,d)=>(h(),p("div",{class:"columns is-12",key:d},[l("div",hl,[l("label",null,[y(c(e.$t("messages.service_model"))+" ",1),_l]),i(n(q),{modelValue:s.unit_price,"onUpdate:modelValue":r=>s.unit_price=r,options:T.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0,required:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),l("div",gl,[l("label",null,[y(c(e.$t("messages.price"))+" ",1),vl]),i(n(P),{modelValue:s.price,"onUpdate:modelValue":r=>s.price=r,placeholder:e.$t("placeholder.inputNumber"),required:"",style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'",width:"100% !important"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),F.value?(h(),p("div",fl,[l("label",null,c(e.$t("messages.details")),1),Ee(l("input",{name:"detail",type:"text",class:"input","onUpdate:modelValue":r=>s.detail=r,placeholder:"ກະລຸນາປ້ອນກ່ອນ...",style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"}},null,8,yl),[[Ue,s.detail]])])):M("",!0),F.value?M("",!0):(h(),p("div",bl,[l("label",null,c(e.$t("messages.est_m")),1),i(n(P),{modelValue:s.est_m,"onUpdate:modelValue":r=>s.est_m=r,placeholder:"ກະລຸນາປ້ອນກ່ອນ...",required:"",style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'",width:"100% !important"}},null,8,["modelValue","onUpdate:modelValue"])])),l("div",wl,[d>0?(h(),p("a",{key:0,onClick:r=>ne(d),class:"button is-danger remove-btn",style:{"margin-top":"22px"}},Vl,8,$l)):M("",!0)])]))),128)),l("div",kl,[i(n(j),{onClick:ie,class:"button is-info",style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'","margin-top":"-20px","margin-left":"-10px"},disabled:!F.value},{default:U(()=>[y(c(e.$t("button.add_item")),1)]),_:1},8,["disabled"])])]),_:1},8,["header"])]),l("div",Tl,[i(n(H),{header:e.$t("messages.profile_and_gallery")},{default:U(()=>[l("div",Fl,[l("label",null,[y(c(e.$t("messages.profile"))+" ",1),Il]),l("label",{class:"upload-box",onClick:le,style:x({border:w.value?"1px dashed #029217":"1px dashed red"})},[w.value?(h(),p("div",Cl,c(w.value),1)):(h(),p("div",Ll,c(e.$t("placeholder.inputFile")),1))],4),l("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:ae},null,32)]),i(n(J)),l("div",El,[l("label",null,[y(c(e.$t("messages.gallery"))+" ",1),Ul]),l("label",{class:"upload-box",onClick:se,style:x({border:v.value?"1px dashed #029217":"1px dashed red"})},[v.value?(h(),p("div",ql,c(v.value),1)):(h(),p("div",Ml,c(e.$t("placeholder.inputFile")),1))],4),l("input",{type:"file",id:"galleryInput",multiple:"",style:{display:"none"},onChange:te},null,32)]),k.value.length>0?(h(),p("div",zl,[(h(!0),p(G,null,O(k.value,(s,d)=>(h(),p("p",{style:{color:"red"},key:d},c(d+1)+". "+c(s),1))),128))])):M("",!0)]),_:1},8,["header"])]),l("div",Bl,[i(n(j),{style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"},type:"submit",severity:"info",loading:n($).btnLoading,disabled:n(Oe)(n(Me).REAL_ESTATE.CREATE)},{default:U(()=>[Dl,y(" "+c(e.$t("button.save_data")),1)]),_:1},8,["loading","disabled"])])])],32)]))}}),ta=qe(Nl,[["__scopeId","data-v-306c3033"]]);export{ta as default};
