import{K as h,a as d,L as v,G as c}from"./index-GH5mf-Pe.js";import{i as m,a as f,A as O,b as P}from"./axios.config-HGXv1ygo.js";var S=Object.defineProperty,w=Object.getOwnPropertyDescriptor,j=(e,a,r,t)=>{for(var s=t>1?void 0:t?w(a,r):a,n=e.length-1,i;n>=0;n--)(i=e[n])&&(s=(t?i(a,r,s):i(s))||s);return t&&s&&S(a,r,s),s},$=(e,a)=>(r,t)=>a(r,t,e);let u=class{constructor(e){this._api=e}async login(e){return{data:(await this._api.axios({method:"post",url:"/auth/login",params:{email:e.email,password:e.password}})).data,message:"ເຂົ້າສູ່ລະບົບສຳເລັດ.",status:"success"}}};u=j([m(),$(0,f(O))],u);var b=Object.defineProperty,y=Object.getOwnPropertyDescriptor,A=(e,a,r,t)=>{for(var s=t>1?void 0:t?y(a,r):a,n=e.length-1,i;n>=0;n--)(i=e[n])&&(s=(t?i(a,r,s):i(s))||s);return t&&s&&b(a,r,s),s},D=(e,a)=>(r,t)=>a(r,t,e);let p=class{constructor(e){this._api=e}async execute(e){return await this._api.login(e)}};p=A([m(),D(0,f(u))],p);var I=Object.defineProperty,E=Object.getOwnPropertyDescriptor,R=(e,a,r,t)=>{for(var s=t>1?void 0:t?E(a,r):a,n=e.length-1,i;n>=0;n--)(i=e[n])&&(s=(t?i(a,r,s):i(s))||s);return t&&s&&I(a,r,s),s},U=(e,a)=>(r,t)=>a(r,t,e);let _=class{constructor(e){this._login=e}async login(e){return await this._login.execute(e)}};_=R([m(),U(0,f(p))],_);const L=h("auth",()=>{const e=d(),a=P.resolve(_),r=v({data:null,isLoading:!1,errorMessage:""}),t=v({email:"",password:""});async function s(i){r.isLoading=!0;try{const o=await a.login(i);if(o.status==="success"&&o.data){localStorage.setItem("token",o.data.access_token),localStorage.setItem("roles",JSON.stringify(o.data.authUser.roles)),localStorage.setItem("permissions",JSON.stringify(o.data.authUser.permissions)),r.errorMessage="";const l=o.data.authUser.roles;l.includes(c.SUPER_ADMIN)||l.includes(c.ADMIN)||l.includes(c.USER)?e.push({name:"customer"}):(l.includes(c.ADMIN_OWNER)||l.includes(c.USER_OWNER))&&e.push({name:"owner.house"})}else r.errorMessage=o.message?o.message:""}catch(o){let l="";o.response.status===422?l=Object.keys(o.response.data.errors).map(g=>`${g}: ${o.response.data.errors[g].join(", ")}`).join("; "):o.response.status===401?l="ອີເມວ ຫຼື ລະຫັດຜ່ານບໍ່ຖືກຕ້ອງ.":l=o.response.data.error,r.errorMessage=l}r.isLoading=!1}async function n(){localStorage.removeItem("token"),localStorage.removeItem("roles"),localStorage.removeItem("permissions"),e.push({name:"login"})}return{state:r,form:t,login:s,logout:n}});export{L as u};
