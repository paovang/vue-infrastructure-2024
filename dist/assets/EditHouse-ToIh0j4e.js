import{d as ne,M as Ee,e as _,f as a,O as $,t as p,h as E,y as r,g as t,a2 as Ue,n as Ge,j as v,u as Be,K as Me,a as ze,H as qe,r as u,o as Re,E as F,Q as Oe,p as Ne,k as xe,F as P,i as j,w as Ae,a3 as De,P as I,b as Pe,_ as je}from"./index-Rev-6aY5.js";import{_ as f}from"./FormInputText.vue_vue_type_script_setup_true_lang-7_GtS0WH.js";import{s as He}from"./textarea.esm-N3y-KMX2.js";import{a as We,u as Ke}from"./vee-validate.esm-h36kLHpZ.js";import{s as q}from"./dropdown.esm-qaK9aGwM.js";import{s as se}from"./inputnumber.esm-N-GTQqzL.js";import{h as Qe,s as H}from"./panel.esm-msA4EXZE.js";import{s as W}from"./divider.esm-hB0qWnSy.js";import{r as Je}from"./real-estate-service.store-fNAnaklQ.js";import{h as Xe}from"./house.store-0funZeEY.js";import{a as te}from"./axios.config-jCy-uYyV.js";import{a as oe,s as R,i as ie}from"./toast-FY7odgkM.js";import{v as Ye}from"./validation-permissions-x2zDczrk.js";import"./inputtext.esm-bOQWpTOG.js";import"./overlayeventbus.esm-5v6W8sok.js";import"./index.esm-mhqQtLni.js";import"./index.esm-edij3XU_.js";import"./index.esm-gZRvskad.js";const Ze={class:"flex flex-column gap-2 mb-3 w-full"},ea=["for"],aa={key:0,class:"text-red-500"},la=["id"],sa=ne({__name:"FormEditTextArea",props:{name:{},label:{},required:{type:Boolean},placeholder:{},value:{}},setup(V){const i=V,{value:h,errorMessage:U}=We(()=>i.name);return Ee(()=>i.value,g=>{h.value=g}),(g,s)=>(v(),_("div",Ze,[a("label",{for:g.name},[$(p(g.label)+" ",1),g.required?(v(),_("span",aa," *")):E("",!0)],8,ea),r(t(He),{"auto-resize":"",rows:"5",modelValue:t(h),"onUpdate:modelValue":s[0]||(s[0]=m=>Ue(h)?h.value=m:null),id:g.name,class:Ge({"p-invalid":t(U)}),"aria-describedby":`text-error-${g.name}`,placeholder:g.placeholder},null,8,["modelValue","id","class","aria-describedby","placeholder"]),a("small",{class:"p-error",id:`text-error-${g.name}`},p(t(U)),9,la)]))}}),b=V=>(Ne("data-v-aab31636"),V=V(),xe(),V),ta={class:"card"},oa={class:"flex flex-wrap gap-2 align-items-center justify-content-between"},ia={class:"p-input-icon-left w-full sm:w-20rem flex-order-1 sm:flex-order-0"},na=b(()=>a("i",{class:"pi pi-arrow-left",style:{color:"green"}},null,-1)),ra=b(()=>a("br",null,null,-1)),da={class:"columns is-12 is-multiline",style:{"margin-top":"20px"}},ca={class:"column is-mobile-12 is-2"},ma=b(()=>a("span",{class:"text-red-500"}," *",-1)),ua={class:"column is-mobile-12 is-2"},pa=b(()=>a("span",{class:"text-red-500"}," *",-1)),ha={class:"column is-mobile-12 is-2"},ga=b(()=>a("span",{class:"text-red-500"}," *",-1)),_a={class:"column is-mobile-12 is-2"},va={class:"column is-mobile-12 is-2"},ya={class:"column is-mobile-12 is-2"},fa={class:"column is-mobile-12 is-4 set-margin-top"},ba={class:"column is-mobile-12 is-2 set-margin-top"},wa={class:"column is-mobile-12 is-2 set-margin-top"},$a={class:"column is-mobile-12 is-2 set-margin-top"},Sa={class:"column is-mobile-12 is-2 set-margin-top"},ka={class:"column is-mobile-12 is-2 set-margin-top"},Va={class:"column is-mobile-12 is-10 set-margin-top"},Ta={class:"column is-mobile-12 is-12 set-margin-top"},Ia={class:"column is-12"},Ca={class:"column is-3"},La=b(()=>a("span",{class:"text-red-500"}," *",-1)),Fa={class:"column is-3"},Ea=b(()=>a("span",{class:"text-red-500"}," *",-1)),Ua={key:0,class:"column is-5"},Ga=["onUpdate:modelValue","placeholder"],Ba={key:1,class:"column is-5"},Ma={class:"column is-1"},za=["onClick"],qa=b(()=>a("i",{class:"pi pi-times-circle"},null,-1)),Ra=[qa],Oa={class:"column is-mobile-12 is-12"},Na={class:"column is-12"},xa={class:"columns is-12 is-multiline"},Aa={class:"column is-mobile-12 is-3"},Da={class:"card",style:{padding:"0rem !important"}},Pa={class:"card-image"},ja={class:"image is-4by3"},Ha=["src"],Wa={class:"content",style:{display:"flex","justify-content":"center"}},Ka={style:{padding:"10px !important"}},Qa={class:"column is-12"},Ja={class:"columns is-12 is-multiline"},Xa={class:"card",style:{padding:"0rem !important"}},Ya={class:"card-image"},Za={class:"image is-4by3"},el=["src"],al={class:"content",style:{display:"flex","justify-content":"center"}},ll={style:{padding:"10px !important"}},sl=b(()=>a("span",{style:{"margin-left":"10px"}},null,-1)),tl={class:"column is-mobile-12 is-12",style:{"text-align":"right"}},ol={key:0,class:"column is-mobile-12 is-12"},il={class:"column is-mobile-12 is-12 text-right"},nl=b(()=>a("i",{class:"pi pi-save",style:{"margin-right":"8px"}},null,-1)),rl=ne({__name:"EditHouse",setup(V){const{t:i}=Be(),h=Me(),U=ze(),g=qe(),{form:s,state:m,update:re,getOne:de,houseGetByOne:ce,deleteGallery:me,updateGallery:ue,addGallery:pe}=Xe(),{getOne:he,realestateType:ge}=Je(),C=u(),S=u(),K=u([{id:"",image:""}]),T=u(),Q=u(),J=localStorage.getItem("token"),_e=async()=>{U.push({name:"owner.house"})},ve=async()=>{s.prices&&(s.prices.length>2?h.add({severity:"error",summary:i("toast.summary.must_be_length_three"),detail:i("toast.detail.cancel_delete"),life:3e3}):s.prices.push({price:"",unit_price:"",detail:""}))},ye=async e=>{s.prices&&s.prices.splice(e,1)},fe={village:i("placeholder.inputText"),location:i("placeholder.inputText"),name:i("placeholder.inputText"),wide:i("placeholder.inputText")},{handleSubmit:be,setFieldValue:y}=Ke({validationSchema:Qe(fe)}),X=u([{id:"sale",name:i("messages.service_sale")},{id:"rent",name:i("messages.service_rent")}]),we=u([{id:"air",name:i("messages.air")},{id:"fan",name:i("messages.fan")},{id:"no",name:i("messages.none")}]),Y=u([{id:"sale",name:i("messages.service_sale")},{id:"day",name:i("messages.service_daily")},{id:"month",name:i("messages.service_monthly")},{id:"year",name:i("messages.service_yearly")}]),O=u(!1),N=u(),x=u();Re(async()=>{await L()});const L=async()=>{const e=Number(g.params.id);m.btnLoading=!0,await de(e),await $e(),m.btnLoading=!1,s.service_model==="rent"?(O.value=!0,N.value=Y.value.slice(1,4),x.value=X.value.splice(1,1)):(O.value=!1,N.value=Y.value.slice(0,1),x.value=X.value.splice(0,1))},$e=async()=>{const e=ce.data.props;y("village",e.village),y("agent_name",e.agent_name),y("owner_name",e.owner_name),y("wide",e.wide),y("long",e.long),y("location",e.location),y("name",e.name),y("bed",e.total_bed),y("bath",e.total_bath),y("garage",e.garage),s.room_type=e.room_type,s.service_model=e.service_model,s.remark=e.remark,s.prices=e.price,C.value=e.image,K.value=e.gallery,await he(),s.real_estate_type_id=e.real_estate_type?e.real_estate_type.id:void 0,s.province_id=e.province?e.province.id:void 0},Z=be(async e=>{s.id=String(g.params.id),s.village=e.village,s.name=e.name,s.agent_name=e.agent_name,s.owner_name=e.owner_name,s.wide=e.wide,s.long=e.long,s.total_bed=e.bed,s.total_bath=e.bath,s.garage=e.garage,s.name=e.name,s.remark=e.remark,s.location=e.location,s.image=S.value,await re(),m.error?await G():(await M(),await L(),await B())}),Se=()=>{document.getElementById("fileInput").click()},ke=async e=>{var d;const o=e.target,l=(d=o.files)==null?void 0:d[0];if(l){if(!await oe(l)){await R({toast:h,error:"error",summary:i("toast.summary.error"),detail:i("toast.summary.real_estate_profile_valid_file_mimes")}),o.value="",S.value="";return}if(!await ie(l)){await R({toast:h,error:"error",summary:i("toast.summary.error"),detail:i("toast.summary.real_estate_profile_valid_file_size")}),o.value="",S.value="";return}const n=new Image;n.src=URL.createObjectURL(l),n.onload=async()=>{const c=n.width,w=n.height;c>A.value||w>D.value?(S.value="",o.value="",await ae(i("messages.dimensions"))):(await le(l,"image"),await Z())}}},ee=(e,o)=>{s.id=e,Q.value=o,Q.value==="update"?(document.getElementById("updateGalleryInput").click(),k.value=[]):(document.getElementById("addGalleryInput").click(),k.value=[])},Ve=async e=>{await me(e),m.error?await G():(await M(),await L(),await B())},Te=async e=>{var d;const o=e.target,l=(d=o.files)==null?void 0:d[0];if(l){if(!await oe(l)){await R({toast:h,error:"error",summary:i("toast.summary.error"),detail:i("toast.summary.real_estate_profile_valid_file_mimes")}),o.value="",C.value="",S.value="";return}if(!await ie(l)){await R({toast:h,error:"error",summary:i("toast.summary.error"),detail:i("toast.summary.real_estate_profile_valid_file_size")}),o.value="",C.value="",S.value="";return}const n=new Image;n.src=URL.createObjectURL(l),n.onload=async()=>{const c=n.width,w=n.height;c>A.value||w>D.value?(T.value="",o.value="",await ae(i("messages.dimensions"))):(await le(l,"gallery"),s.gallery=T.value,await ue(),m.error?await G():(await M(),await L(),await B()))}}},k=u([]),A=u(2e3),D=u(1900),Ie=async e=>{const o=e.target,l=o.files,d=1*1024*1024,n=5*1024*1024;if(l){let c=0;for(let w=0;w<l.length;w++){const z=l[w];c+=z.size;try{await Ce(z,d)}catch(Fe){k.value.push(Fe)}}if(c>n){k.value.push(i("toast.summary.maximum_allowed_size_5MB")),o.value="";return}k.value.length<=0?(await Le(l),s.gallery=T.value,await pe(),m.error?await G():(await M(),await L(),await B())):o.value=""}},Ce=(e,o)=>new Promise((l,d)=>{if(e.size>o)d(`${e.name} => `+i("toast.summary.real_estate_profile_valid_file_size_1MB"));else if(!["image/jpeg","image/jpg"].includes(e.type))d(`${e.name} => `+i("toast.summary.real_estate_profile_valid_file_mimes"));else{const c=new Image;c.src=URL.createObjectURL(e),c.onload=()=>{const w=c.width,z=c.height;w>A.value||z>D.value?d(`${e.name} => `+i("messages.dimensions")):l("")},c.onerror=()=>{d(`Error loading image ${e.name}.`)}}}),ae=e=>{h.add({severity:"error",summary:i("toast.summary.error"),detail:e,life:3e3})},G=()=>{h.add({severity:"error",summary:i("toast.summary.error"),detail:`${m.error}`,life:3e3})},B=()=>{h.add({severity:"success",summary:i("toast.summary.success"),detail:i("toast.detail.successfully"),life:3e3})},M=async()=>{C.value="",S.value="",T.value="";const e=document.getElementById("fileInput");e.value="";const o=document.getElementById("updateGalleryInput");o.value="";const l=document.getElementById("addGalleryInput");l.value=""},Le=async e=>{m.btnLoading=!0;try{let o=new FormData;for(let n=0;n<e.length;n++)o.append("files[]",e[n]);const d=(await te.post("http://188.166.183.153:8000/api/upload/multiple/files",o,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${J}`}})).data.filename.map(n=>({image:`${n}`}));T.value=d,m.btnLoading=!1}catch(o){console.error("Upload failed:",o)}},le=async(e,o)=>{var l,d;m.btnLoading=!0;try{let n=new FormData;n.append("file",e);const c=await te.post("http://188.166.183.153:8000/api/upload_file",n,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${J}`}});o==="image"?S.value=(l=c.data)==null?void 0:l.filename:T.value=(d=c.data)==null?void 0:d.filename,m.btnLoading=!1}catch(n){console.error("Upload failed:",n)}};return(e,o)=>(v(),_("div",ta,[a("div",oa,[a("span",ia,[a("h2",{style:{"font-weight":"bold","font-size":"20px"},class:"arrow-left",onClick:o[0]||(o[0]=l=>_e())},[na,$(" "+p(e.$t("messages.form_register")),1)])])]),ra,r(t(W)),a("form",{onSubmit:o[5]||(o[5]=Oe(l=>t(Z)(),["prevent"])),class:"flex flex-column gap-3 h-full"},[a("div",da,[a("div",ca,[a("label",null,[$(p(e.$t("messages.realestate_type"))+" ",1),ma]),r(t(q),{name:"real_estate_type",style:{"margin-top":"8px"},modelValue:t(s).real_estate_type_id,"onUpdate:modelValue":o[1]||(o[1]=l=>t(s).real_estate_type_id=l),options:t(ge).props,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0},null,8,["modelValue","options","placeholder"])]),a("div",ua,[a("label",null,[$(p(e.$t("messages.service_model"))+" ",1),pa]),r(t(q),{style:{"margin-top":"8px"},modelValue:t(s).service_model,"onUpdate:modelValue":o[2]||(o[2]=l=>t(s).service_model=l),options:x.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),optionValue:"id",highlightOnSelect:!0,class:"w-full"},null,8,["modelValue","options","placeholder"])]),a("div",ha,[a("label",null,[$(p(e.$t("messages.room_type"))+" ",1),ga]),r(t(q),{style:{"margin-top":"8px"},modelValue:t(s).room_type,"onUpdate:modelValue":o[3]||(o[3]=l=>t(s).room_type=l),options:we.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0},null,8,["modelValue","options","placeholder"])]),a("div",_a,[r(f,{name:"name",label:e.$t("messages.real_estate_name"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",va,[r(f,{name:"agent_name",label:e.$t("messages.name"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",ya,[r(f,{name:"owner_name",label:e.$t("messages.owner"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",fa,[r(f,{name:"village",label:e.$t("messages.address"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).village},null,8,["label","placeholder","value"])]),a("div",ba,[r(f,{name:"bed",label:e.$t("messages.total_bed"),placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",wa,[r(f,{name:"bath",label:e.$t("messages.total_bath"),placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",$a,[r(f,{name:"wide",label:e.$t("messages.wide"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).wide},null,8,["label","placeholder","value"])]),a("div",Sa,[r(f,{name:"long",label:e.$t("messages.long"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).long},null,8,["label","placeholder","value"])]),a("div",ka,[r(f,{name:"garage",label:e.$t("messages.garage"),required:"",placeholder:e.$t("placeholder.inputTextGarage"),class:"h-full"},null,8,["label","placeholder"])]),a("div",Va,[r(f,{name:"location",label:e.$t("messages.location"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).location},null,8,["label","placeholder","value"])]),a("div",Ta,[r(sa,{name:"remark",label:e.$t("messages.remark"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).remark},null,8,["label","placeholder","value"])]),a("div",Ia,[r(t(H),{header:e.$t("messages.setting_price_for_rent")},{default:F(()=>[(v(!0),_(P,null,j(t(s).prices,(l,d)=>(v(),_("div",{class:"columns is-12",key:d},[a("div",Ca,[a("label",null,[$(p(e.$t("messages.service_model"))+" ",1),La]),r(t(q),{modelValue:l.unit_price,"onUpdate:modelValue":n=>l.unit_price=n,options:N.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0,required:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),a("div",Fa,[a("label",null,[$(p(e.$t("messages.price"))+" ",1),Ea]),r(t(se),{modelValue:l.price,"onUpdate:modelValue":n=>l.price=n,placeholder:e.$t("placeholder.inputText"),required:"",style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'",width:"100% !important"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),t(s).service_model==="rent"?(v(),_("div",Ua,[a("label",null,p(e.$t("messages.details")),1),Ae(a("input",{name:"detail",type:"text",class:"input","onUpdate:modelValue":n=>l.detail=n,placeholder:e.$t("placeholder.inputText"),style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"}},null,8,Ga),[[De,l.detail]])])):E("",!0),t(s).service_model==="sale"?(v(),_("div",Ba,[a("label",null,p(e.$t("messages.est_m")),1),r(t(se),{modelValue:l.est_m,"onUpdate:modelValue":n=>l.est_m=n,placeholder:e.$t("placeholder.inputText"),required:"",style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'",width:"100% !important"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):E("",!0),a("div",Ma,[d>0?(v(),_("a",{key:0,onClick:n=>ye(d),class:"button is-danger remove-btn",style:{"margin-top":"22px"}},Ra,8,za)):E("",!0)])]))),128)),a("div",Oa,[r(t(I),{onClick:ve,class:"button is-primary",disabled:!O.value,style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"}},{default:F(()=>[$(p(e.$t("button.add_item")),1)]),_:1},8,["disabled"])])]),_:1},8,["header"])]),a("div",Na,[r(t(H),{header:e.$t("messages.profile")},{default:F(()=>[a("div",xa,[a("div",Aa,[a("div",Da,[a("div",Pa,[a("figure",ja,[a("img",{src:C.value,alt:"Placeholder image"},null,8,Ha)])]),a("div",Wa,[a("span",Ka,[r(t(I),{icon:"pi pi-pencil",severity:"warning",rounded:"",onClick:Se,style:{color:"white"}}),a("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:ke},null,32)])])])])])]),_:1},8,["header"])]),a("div",Qa,[r(t(H),{header:e.$t("messages.profile_and_gallery")},{default:F(()=>[a("div",Ja,[(v(!0),_(P,null,j(K.value,(l,d)=>(v(),_("div",{class:"column is-mobile-12 is-3",key:d},[a("div",Xa,[a("div",Ya,[a("figure",Za,[a("img",{src:l==null?void 0:l.image,alt:"Placeholder image"},null,8,el)])]),a("div",al,[a("span",ll,[r(t(I),{icon:"pi pi-trash",severity:"danger",rounded:"",onClick:n=>Ve(l.id)},null,8,["onClick"]),sl,r(t(I),{icon:"pi pi-pencil",severity:"warning",rounded:"",onClick:n=>ee(l.id,"update"),style:{color:"white"}},null,8,["onClick"])]),a("input",{type:"file",id:"updateGalleryInput",style:{display:"none"},onChange:Te},null,32),a("input",{type:"file",id:"addGalleryInput",multiple:"",style:{display:"none"},onChange:Ie},null,32)])])]))),128)),r(t(W)),a("div",tl,[r(t(I),{icon:"pi pi-plus-circle",onClick:o[4]||(o[4]=l=>ee(t(g).params.id,"add"))})]),r(t(W)),k.value.length>0?(v(),_("div",ol,[(v(!0),_(P,null,j(k.value,(l,d)=>(v(),_("p",{style:{color:"red"},key:d},p(d+1)+". "+p(l),1))),128))])):E("",!0)])]),_:1},8,["header"])]),a("div",il,[r(t(I),{style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"},type:"submit",severity:"info",loading:t(m).btnLoading,disabled:t(Ye)(t(Pe).REAL_ESTATE.UPDATE)},{default:F(()=>[nl,$(" "+p(e.$t("button.edit_data")),1)]),_:1},8,["loading","disabled"])])])],32)]))}}),Il=je(rl,[["__scopeId","data-v-aab31636"]]);export{Il as default};
