import{d as me,M as qe,e as _,f as a,O as y,t as c,h as z,y as r,g as t,a2 as De,n as Ae,j as v,u as Ne,K as Pe,a as xe,H as je,r as p,o as He,E as U,Q as We,p as Ke,k as Qe,F as H,i as W,w as Je,a3 as Xe,P as I,b as Ye,_ as Ze}from"./index-yVBRwehP.js";import{_ as $}from"./FormInputText.vue_vue_type_script_setup_true_lang-QPUUvTW_.js";import{s as ea}from"./textarea.esm-oSNTGwmX.js";import{a as aa,u as la}from"./vee-validate.esm-g7d8zZ0k.js";import{s as C}from"./dropdown.esm-B-FVLpU9.js";import{s as ne}from"./inputnumber.esm-AY9cc-bA.js";import{h as sa,s as K}from"./panel.esm-9bCzaiVe.js";import{s as Q}from"./divider.esm-KgK1LIkt.js";import{r as ta}from"./real-estate-service.store-JZuHzYG4.js";import{h as ia}from"./house.store-lqBvVWIO.js";import{p as oa}from"./province.store-cJ7IbBxU.js";import{d as na}from"./district.store-GZRzhHiR.js";import{a as re}from"./axios.config-jCy-uYyV.js";import{a as de,s as q,i as ce}from"./toast-FY7odgkM.js";import{v as ra}from"./validation-permissions-cXWJ3GKe.js";import"./inputtext.esm-EDgTkcJ7.js";import"./overlayeventbus.esm-hZYxRuN4.js";import"./index.esm-LBttzci4.js";import"./index.esm-Sj8NfkAX.js";import"./index.esm-BIqYEZf7.js";const da={class:"flex flex-column gap-2 mb-3 w-full"},ca=["for"],ma={key:0,class:"text-red-500"},ua=["id"],pa=me({__name:"FormEditTextArea",props:{name:{},label:{},required:{type:Boolean},placeholder:{},value:{}},setup(k){const o=k,{value:h,errorMessage:E}=aa(()=>o.name);return qe(()=>o.value,g=>{h.value=g}),(g,s)=>(v(),_("div",da,[a("label",{for:g.name},[y(c(g.label)+" ",1),g.required?(v(),_("span",ma," *")):z("",!0)],8,ca),r(t(ea),{"auto-resize":"",rows:"5",modelValue:t(h),"onUpdate:modelValue":s[0]||(s[0]=u=>De(h)?h.value=u:null),id:g.name,class:Ae({"p-invalid":t(E)}),"aria-describedby":`text-error-${g.name}`,placeholder:g.placeholder},null,8,["modelValue","id","class","aria-describedby","placeholder"]),a("small",{class:"p-error",id:`text-error-${g.name}`},c(t(E)),9,ua)]))}}),f=k=>(Ke("data-v-684a87e2"),k=k(),Qe(),k),ha={class:"card"},ga={class:"flex flex-wrap gap-2 align-items-center justify-content-between"},_a={class:"p-input-icon-left w-full sm:w-20rem flex-order-1 sm:flex-order-0"},va=f(()=>a("i",{class:"pi pi-arrow-left",style:{color:"green"}},null,-1)),fa=f(()=>a("br",null,null,-1)),ya={class:"columns is-12 is-multiline",style:{"margin-top":"20px"}},wa={class:"column is-mobile-12 is-2"},ba=f(()=>a("span",{class:"text-red-500"}," *",-1)),$a={class:"column is-mobile-12 is-2"},Sa=f(()=>a("span",{class:"text-red-500"}," *",-1)),Va={class:"column is-mobile-12 is-2"},ka=f(()=>a("span",{class:"text-red-500"}," *",-1)),Ta={class:"column is-mobile-12 is-2"},Ia={class:"column is-mobile-12 is-2"},Ca=f(()=>a("span",{class:"text-red-500"}," *",-1)),Fa={class:"column is-mobile-12 is-2"},La=f(()=>a("span",{class:"text-red-500"}," *",-1)),Ua={class:"column is-mobile-12 is-2"},za={class:"column is-mobile-12 is-2"},Ea={class:"column is-mobile-12 is-2 set-margin-top"},Ga={class:"column is-mobile-12 is-2 set-margin-top"},Ba={class:"column is-mobile-12 is-2"},Ma={class:"column is-mobile-12 is-2"},Oa={class:"column is-mobile-12 is-2 set-margin-top"},Ra={class:"column is-mobile-12 is-10"},qa={class:"column is-mobile-12 is-12"},Da={class:"column is-12"},Aa={class:"column is-3"},Na=f(()=>a("span",{class:"text-red-500"}," *",-1)),Pa={class:"column is-3"},xa=f(()=>a("span",{class:"text-red-500"}," *",-1)),ja={key:0,class:"column is-5"},Ha=["onUpdate:modelValue","placeholder"],Wa={key:1,class:"column is-5"},Ka={class:"column is-1"},Qa=["onClick"],Ja=f(()=>a("i",{class:"pi pi-times-circle"},null,-1)),Xa=[Ja],Ya={class:"column is-mobile-12 is-12"},Za={class:"column is-12"},el={class:"columns is-12 is-multiline"},al={class:"column is-mobile-12 is-3"},ll={class:"card",style:{padding:"0rem !important"}},sl={class:"card-image"},tl={class:"image is-4by3"},il=["src"],ol={class:"content",style:{display:"flex","justify-content":"center"}},nl={style:{padding:"10px !important"}},rl={class:"column is-12"},dl={class:"columns is-12 is-multiline"},cl={class:"card",style:{padding:"0rem !important"}},ml={class:"card-image"},ul={class:"image is-4by3"},pl=["src"],hl={class:"content",style:{display:"flex","justify-content":"center"}},gl={style:{padding:"10px !important"}},_l=f(()=>a("span",{style:{"margin-left":"10px"}},null,-1)),vl={class:"column is-mobile-12 is-12",style:{"text-align":"right"}},fl={key:0,class:"column is-mobile-12 is-12"},yl={class:"column is-mobile-12 is-12 text-right"},wl=f(()=>a("i",{class:"pi pi-save",style:{"margin-right":"8px"}},null,-1)),bl=me({__name:"EditHouse",setup(k){const{t:o}=Ne(),h=Pe(),E=xe(),g=je(),{form:s,state:u,update:ue,getOne:pe,houseGetByOne:D,deleteGallery:he,updateGallery:ge,addGallery:_e}=ia(),{getOne:ve,realestateType:fe}=ta(),{getAll:ye,state:we,setStateFilter:be}=oa(),{getAll:J,state:$e,setStateFilter:G}=na(),F=p(),S=p(),X=p([{id:"",image:""}]),T=p(),Y=p(),Z=localStorage.getItem("token"),Se=async()=>{E.push({name:"owner.house"})},Ve=async()=>{s.prices&&(s.prices.length>2?h.add({severity:"error",summary:o("toast.summary.must_be_length_three"),detail:o("toast.detail.cancel_delete"),life:3e3}):s.prices.push({price:"",unit_price:"",detail:""}))},ke=async e=>{s.prices&&s.prices.splice(e,1)},Te={village:o("placeholder.inputText"),location:o("placeholder.inputText"),name:o("placeholder.inputText"),wide:o("placeholder.inputText")},{handleSubmit:Ie,setFieldValue:w}=la({validationSchema:sa(Te)}),ee=p([{id:"sale",name:o("messages.service_sale")},{id:"rent",name:o("messages.service_rent")}]),Ce=p([{id:"air",name:o("messages.air")},{id:"fan",name:o("messages.fan")},{id:"no",name:o("messages.none")}]),ae=p([{id:"sale",name:o("messages.service_sale")},{id:"day",name:o("messages.service_daily")},{id:"month",name:o("messages.service_monthly")},{id:"year",name:o("messages.service_yearly")}]),A=p(!1),N=p(),P=p();He(async()=>{await L()});const L=async()=>{const e=Number(g.params.id);u.btnLoading=!0,await pe(e),await Fe(),u.btnLoading=!1,s.service_model==="rent"?(A.value=!0,N.value=ae.value.slice(1,4),P.value=ee.value.splice(1,1)):(A.value=!1,N.value=ae.value.slice(0,1),P.value=ee.value.splice(0,1))},Fe=async()=>{const e=D.data.props;w("village",e.village),w("zipcode",e.zip_code),w("wide",e.wide),w("long",e.long),w("location",e.location),w("name",e.name),w("bed",e.total_bed),w("bath",e.total_bath),w("garage",e.garage),s.room_type=e.room_type,s.service_model=e.service_model,s.remark=e.remark,s.prices=e.price,F.value=e.image,X.value=e.gallery,be.limit=1e3,await ye(),await ve(),s.real_estate_type_id=e.real_estate_type?e.real_estate_type.id:void 0,s.province_id=e.province?e.province.id:void 0,G.filter&&(G.filter.province_id=s.province_id,await J(),await le())},Le=async e=>{G.filter&&(G.filter.province_id=e,await J(),await le())},le=async()=>{s.district_id=D.data.props.district?D.data.props.district.id:void 0},se=Ie(async e=>{s.id=String(g.params.id),s.village=e.village,s.name=e.name,s.zip_code=e.zipcode,s.wide=e.wide,s.long=e.long,s.total_bed=e.bed,s.total_bath=e.bath,s.garage=e.garage,s.name=e.name,s.remark=e.remark,s.location=e.location,s.image=S.value,await ue(),u.error?await B():(await O(),await L(),await M())}),Ue=()=>{document.getElementById("fileInput").click()},ze=async e=>{var d;const i=e.target,l=(d=i.files)==null?void 0:d[0];if(l){if(!await de(l)){await q({toast:h,error:"error",summary:o("toast.summary.error"),detail:o("toast.summary.real_estate_profile_valid_file_mimes")}),i.value="",S.value="";return}if(!await ce(l)){await q({toast:h,error:"error",summary:o("toast.summary.error"),detail:o("toast.summary.real_estate_profile_valid_file_size")}),i.value="",S.value="";return}const n=new Image;n.src=URL.createObjectURL(l),n.onload=async()=>{const m=n.width,b=n.height;m>x.value||b>j.value?(S.value="",i.value="",await ie(o("messages.dimensions"))):(await oe(l,"image"),await se())}}},te=(e,i)=>{s.id=e,Y.value=i,Y.value==="update"?(document.getElementById("updateGalleryInput").click(),V.value=[]):(document.getElementById("addGalleryInput").click(),V.value=[])},Ee=async e=>{await he(e),u.error?await B():(await O(),await L(),await M())},Ge=async e=>{var d;const i=e.target,l=(d=i.files)==null?void 0:d[0];if(l){if(!await de(l)){await q({toast:h,error:"error",summary:o("toast.summary.error"),detail:o("toast.summary.real_estate_profile_valid_file_mimes")}),i.value="",F.value="",S.value="";return}if(!await ce(l)){await q({toast:h,error:"error",summary:o("toast.summary.error"),detail:o("toast.summary.real_estate_profile_valid_file_size")}),i.value="",F.value="",S.value="";return}const n=new Image;n.src=URL.createObjectURL(l),n.onload=async()=>{const m=n.width,b=n.height;m>x.value||b>j.value?(T.value="",i.value="",await ie(o("messages.dimensions"))):(await oe(l,"gallery"),s.gallery=T.value,await ge(),u.error?await B():(await O(),await L(),await M()))}}},V=p([]),x=p(2e3),j=p(1900),Be=async e=>{const i=e.target,l=i.files,d=1*1024*1024,n=5*1024*1024;if(l){let m=0;for(let b=0;b<l.length;b++){const R=l[b];m+=R.size;try{await Me(R,d)}catch(Re){V.value.push(Re)}}if(m>n){V.value.push(o("toast.summary.maximum_allowed_size_5MB")),i.value="";return}V.value.length<=0?(await Oe(l),s.gallery=T.value,await _e(),u.error?await B():(await O(),await L(),await M())):i.value=""}},Me=(e,i)=>new Promise((l,d)=>{if(e.size>i)d(`${e.name} => `+o("toast.summary.real_estate_profile_valid_file_size_1MB"));else if(!["image/jpeg","image/jpg"].includes(e.type))d(`${e.name} => `+o("toast.summary.real_estate_profile_valid_file_mimes"));else{const m=new Image;m.src=URL.createObjectURL(e),m.onload=()=>{const b=m.width,R=m.height;b>x.value||R>j.value?d(`${e.name} => `+o("messages.dimensions")):l("")},m.onerror=()=>{d(`Error loading image ${e.name}.`)}}}),ie=e=>{h.add({severity:"error",summary:o("toast.summary.error"),detail:e,life:3e3})},B=()=>{h.add({severity:"error",summary:o("toast.summary.error"),detail:`${u.error}`,life:3e3})},M=()=>{h.add({severity:"success",summary:o("toast.summary.success"),detail:o("toast.detail.successfully"),life:3e3})},O=async()=>{F.value="",S.value="",T.value="";const e=document.getElementById("fileInput");e.value="";const i=document.getElementById("updateGalleryInput");i.value="";const l=document.getElementById("addGalleryInput");l.value=""},Oe=async e=>{u.btnLoading=!0;try{let i=new FormData;for(let n=0;n<e.length;n++)i.append("files[]",e[n]);const d=(await re.post("http://188.166.183.153:8000/api/upload/multiple/files",i,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${Z}`}})).data.filename.map(n=>({image:`${n}`}));T.value=d,u.btnLoading=!1}catch(i){console.error("Upload failed:",i)}},oe=async(e,i)=>{var l,d;u.btnLoading=!0;try{let n=new FormData;n.append("file",e);const m=await re.post("http://188.166.183.153:8000/api/upload_file",n,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${Z}`}});i==="image"?S.value=(l=m.data)==null?void 0:l.filename:T.value=(d=m.data)==null?void 0:d.filename,u.btnLoading=!1}catch(n){console.error("Upload failed:",n)}};return(e,i)=>(v(),_("div",ha,[a("div",ga,[a("span",_a,[a("h2",{style:{"font-weight":"bold","font-size":"20px"},class:"arrow-left",onClick:i[0]||(i[0]=l=>Se())},[va,y(" "+c(e.$t("messages.form_register")),1)])])]),fa,r(t(Q)),a("form",{onSubmit:i[8]||(i[8]=We(l=>t(se)(),["prevent"])),class:"flex flex-column gap-3 h-full"},[a("div",ya,[a("div",wa,[a("label",null,[y(c(e.$t("messages.realestate_type"))+" ",1),ba]),r(t(C),{name:"real_estate_type",style:{"margin-top":"8px"},modelValue:t(s).real_estate_type_id,"onUpdate:modelValue":i[1]||(i[1]=l=>t(s).real_estate_type_id=l),options:t(fe).props,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0},null,8,["modelValue","options","placeholder"])]),a("div",$a,[a("label",null,[y(c(e.$t("messages.service_model"))+" ",1),Sa]),r(t(C),{style:{"margin-top":"8px"},modelValue:t(s).service_model,"onUpdate:modelValue":i[2]||(i[2]=l=>t(s).service_model=l),options:P.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),optionValue:"id",highlightOnSelect:!0,class:"w-full"},null,8,["modelValue","options","placeholder"])]),a("div",Va,[a("label",null,[y(c(e.$t("messages.room_type"))+" ",1),ka]),r(t(C),{style:{"margin-top":"8px"},modelValue:t(s).room_type,"onUpdate:modelValue":i[3]||(i[3]=l=>t(s).room_type=l),options:Ce.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0},null,8,["modelValue","options","placeholder"])]),a("div",Ta,[r($,{name:"name",label:e.$t("messages.real_estate_name"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",Ia,[a("label",null,[y(c(e.$t("messages.province"))+" ",1),Ca]),r(t(C),{style:{"margin-top":"8px"},modelValue:t(s).province_id,"onUpdate:modelValue":i[4]||(i[4]=l=>t(s).province_id=l),options:t(we).data.props,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0,filter:"",onChange:i[5]||(i[5]=l=>Le(t(s).province_id))},null,8,["modelValue","options","placeholder"])]),a("div",Fa,[a("label",null,[y(c(e.$t("messages.district"))+" ",1),La]),r(t(C),{style:{"margin-top":"8px"},modelValue:t(s).district_id,"onUpdate:modelValue":i[6]||(i[6]=l=>t(s).district_id=l),options:t($e).data.props,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0,filter:""},null,8,["modelValue","options","placeholder"])]),a("div",Ua,[r($,{name:"village",label:e.$t("messages.village"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).village},null,8,["label","placeholder","value"])]),a("div",za,[r($,{name:"zipcode",label:e.$t("messages.zip_code"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).zip_code},null,8,["label","placeholder","value"])]),a("div",Ea,[r($,{name:"bed",label:e.$t("messages.total_bed"),placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",Ga,[r($,{name:"bath",label:e.$t("messages.total_bath"),placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),a("div",Ba,[r($,{name:"wide",label:e.$t("messages.wide"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).wide},null,8,["label","placeholder","value"])]),a("div",Ma,[r($,{name:"long",label:e.$t("messages.long"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).long},null,8,["label","placeholder","value"])]),a("div",Oa,[r($,{name:"garage",label:e.$t("messages.garage"),required:"",placeholder:e.$t("placeholder.inputTextGarage"),class:"h-full"},null,8,["label","placeholder"])]),a("div",Ra,[r($,{name:"location",label:e.$t("messages.location"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).location},null,8,["label","placeholder","value"])]),a("div",qa,[r(pa,{name:"remark",label:e.$t("messages.remark"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:t(s).remark},null,8,["label","placeholder","value"])]),a("div",Da,[r(t(K),{header:e.$t("messages.setting_price_for_rent")},{default:U(()=>[(v(!0),_(H,null,W(t(s).prices,(l,d)=>(v(),_("div",{class:"columns is-12",key:d},[a("div",Aa,[a("label",null,[y(c(e.$t("messages.service_model"))+" ",1),Na]),r(t(C),{modelValue:l.unit_price,"onUpdate:modelValue":n=>l.unit_price=n,options:N.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0,required:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),a("div",Pa,[a("label",null,[y(c(e.$t("messages.price"))+" ",1),xa]),r(t(ne),{modelValue:l.price,"onUpdate:modelValue":n=>l.price=n,placeholder:e.$t("placeholder.inputText"),required:"",style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'",width:"100% !important"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),t(s).service_model==="rent"?(v(),_("div",ja,[a("label",null,c(e.$t("messages.details")),1),Je(a("input",{name:"detail",type:"text",class:"input","onUpdate:modelValue":n=>l.detail=n,placeholder:e.$t("placeholder.inputText"),style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"}},null,8,Ha),[[Xe,l.detail]])])):z("",!0),t(s).service_model==="sale"?(v(),_("div",Wa,[a("label",null,c(e.$t("messages.est_m")),1),r(t(ne),{modelValue:l.est_m,"onUpdate:modelValue":n=>l.est_m=n,placeholder:e.$t("placeholder.inputText"),required:"",style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'",width:"100% !important"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):z("",!0),a("div",Ka,[d>0?(v(),_("a",{key:0,onClick:n=>ke(d),class:"button is-danger remove-btn",style:{"margin-top":"22px"}},Xa,8,Qa)):z("",!0)])]))),128)),a("div",Ya,[r(t(I),{onClick:Ve,class:"button is-primary",disabled:!A.value,style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"}},{default:U(()=>[y(c(e.$t("button.add_item")),1)]),_:1},8,["disabled"])])]),_:1},8,["header"])]),a("div",Za,[r(t(K),{header:e.$t("messages.profile")},{default:U(()=>[a("div",el,[a("div",al,[a("div",ll,[a("div",sl,[a("figure",tl,[a("img",{src:F.value,alt:"Placeholder image"},null,8,il)])]),a("div",ol,[a("span",nl,[r(t(I),{icon:"pi pi-pencil",severity:"warning",rounded:"",onClick:Ue,style:{color:"white"}}),a("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:ze},null,32)])])])])])]),_:1},8,["header"])]),a("div",rl,[r(t(K),{header:e.$t("messages.profile_and_gallery")},{default:U(()=>[a("div",dl,[(v(!0),_(H,null,W(X.value,(l,d)=>(v(),_("div",{class:"column is-mobile-12 is-3",key:d},[a("div",cl,[a("div",ml,[a("figure",ul,[a("img",{src:l==null?void 0:l.image,alt:"Placeholder image"},null,8,pl)])]),a("div",hl,[a("span",gl,[r(t(I),{icon:"pi pi-trash",severity:"danger",rounded:"",onClick:n=>Ee(l.id)},null,8,["onClick"]),_l,r(t(I),{icon:"pi pi-pencil",severity:"warning",rounded:"",onClick:n=>te(l.id,"update"),style:{color:"white"}},null,8,["onClick"])]),a("input",{type:"file",id:"updateGalleryInput",style:{display:"none"},onChange:Ge},null,32),a("input",{type:"file",id:"addGalleryInput",multiple:"",style:{display:"none"},onChange:Be},null,32)])])]))),128)),r(t(Q)),a("div",vl,[r(t(I),{icon:"pi pi-plus-circle",onClick:i[7]||(i[7]=l=>te(t(g).params.id,"add"))})]),r(t(Q)),V.value.length>0?(v(),_("div",fl,[(v(!0),_(H,null,W(V.value,(l,d)=>(v(),_("p",{style:{color:"red"},key:d},c(d+1)+". "+c(l),1))),128))])):z("",!0)])]),_:1},8,["header"])]),a("div",yl,[r(t(I),{style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"},type:"submit",severity:"info",loading:t(u).btnLoading,disabled:t(ra)(t(Ye).REAL_ESTATE.UPDATE)},{default:U(()=>[wl,y(" "+c(e.$t("button.edit_data")),1)]),_:1},8,["loading","disabled"])])])],32)]))}}),Nl=Ze(bl,[["__scopeId","data-v-684a87e2"]]);export{Nl as default};
