import{d as ie,O as Be,e as f,f as l,Q as y,t as m,h as H,y as n,g as s,X as Ee,n as Oe,j as v,u as qe,M as De,a as Me,H as Re,r as _,o as Ae,E as q,V as Ne,p as xe,k as Pe,F as N,i as x,w as je,a3 as He,U as L,_ as We}from"./index-PzTuJOUN.js";import{_ as $}from"./FormInputText.vue_vue_type_script_setup_true_lang-_nNwcA8S.js";import{s as Qe}from"./textarea.esm-H0kjQfci.js";import{b as Xe,u as Je}from"./index.esm-6dCfzI_X.js";import{s as C}from"./dropdown.esm-ZDqzpD83.js";import{s as Ke}from"./inputnumber.esm-F6aDnC6G.js";import{h as Ye,s as P}from"./panel.esm-yzSIvyNB.js";import{s as j}from"./divider.esm-w7TYeOde.js";import{r as Ze}from"./real-estate-service.store-gY5_kjZI.js";import{h as el}from"./house.store-1bfWeDqM.js";import{p as ll}from"./province.store-L6GfJoSN.js";import{d as al}from"./district.store-B2S-fzuI.js";import{c as ae}from"./axios.config-gXfSTYZr.js";import{v as te,s as D,i as se}from"./toast-AS0Hl_8E.js";import"./inputtext.esm-ASbIeNyZ.js";import"./overlayeventbus.esm-ReU6tk2n.js";import"./index.esm-a8LTY2Sx.js";import"./index.esm-Vq0scFfZ.js";const tl={class:"flex flex-column gap-2 mb-3 w-full"},sl=["for"],il={key:0,class:"text-red-500"},ol=["id"],nl=ie({__name:"FormEditTextArea",props:{name:{},label:{},required:{type:Boolean},placeholder:{},value:{}},setup(k){const d=k,{value:u,errorMessage:z}=Xe(()=>d.name);return Be(()=>d.value,h=>{u.value=h}),(h,t)=>(v(),f("div",tl,[l("label",{for:h.name},[y(m(h.label)+" ",1),h.required?(v(),f("span",il," *")):H("",!0)],8,sl),n(s(Qe),{"auto-resize":"",rows:"5",modelValue:s(u),"onUpdate:modelValue":t[0]||(t[0]=p=>Ee(u)?u.value=p:null),id:h.name,class:Oe({"p-invalid":s(z)}),"aria-describedby":`text-error-${h.name}`,placeholder:h.placeholder},null,8,["modelValue","id","class","aria-describedby","placeholder"]),l("small",{class:"p-error",id:`text-error-${h.name}`},m(s(z)),9,ol)]))}}),g=k=>(xe("data-v-e850fd30"),k=k(),Pe(),k),rl={class:"card"},dl={class:"flex flex-wrap gap-2 align-items-center justify-content-between"},cl={class:"p-input-icon-left w-full sm:w-20rem flex-order-1 sm:flex-order-0"},ml=g(()=>l("i",{class:"pi pi-arrow-left",style:{color:"green"}},null,-1)),pl=g(()=>l("br",null,null,-1)),ul={class:"columns is-12 is-multiline",style:{"margin-top":"20px"}},hl={class:"column is-mobile-12 is-2"},gl=g(()=>l("span",{class:"text-red-500"}," *",-1)),_l={class:"column is-mobile-12 is-2"},fl=g(()=>l("span",{class:"text-red-500"}," *",-1)),vl={class:"column is-mobile-12 is-2"},yl=g(()=>l("span",{class:"text-red-500"}," *",-1)),wl={class:"column is-mobile-12 is-2"},bl={class:"column is-mobile-12 is-2"},$l=g(()=>l("span",{class:"text-red-500"}," *",-1)),Sl={class:"column is-mobile-12 is-2"},Vl=g(()=>l("span",{class:"text-red-500"}," *",-1)),kl={class:"column is-mobile-12 is-2"},Il={class:"column is-mobile-12 is-2"},Cl={class:"column is-mobile-12 is-2 set-margin-top"},Fl={class:"column is-mobile-12 is-2 set-margin-top"},Tl={class:"column is-mobile-12 is-2"},Ll={class:"column is-mobile-12 is-2"},zl={class:"column is-mobile-12 is-2 set-margin-top"},Ul={class:"column is-mobile-12 is-10"},Gl={class:"column is-mobile-12 is-12"},Bl={class:"column is-12"},El={class:"column is-3"},Ol=g(()=>l("span",{class:"text-red-500"}," *",-1)),ql={class:"column is-3"},Dl=g(()=>l("span",{class:"text-red-500"}," *",-1)),Ml={class:"column is-5"},Rl=["onUpdate:modelValue","placeholder"],Al={class:"column is-1"},Nl=["onClick"],xl=g(()=>l("i",{class:"pi pi-times-circle"},null,-1)),Pl=[xl],jl={class:"column is-mobile-12 is-12"},Hl={class:"column is-12"},Wl={class:"columns is-12 is-multiline"},Ql={class:"column is-mobile-12 is-3"},Xl={class:"card",style:{padding:"0rem !important"}},Jl={class:"card-image"},Kl={class:"image is-4by3"},Yl=["src"],Zl={class:"content",style:{display:"flex","justify-content":"center"}},ea={style:{padding:"10px !important"}},la={class:"column is-12"},aa={class:"columns is-12 is-multiline"},ta={class:"card",style:{padding:"0rem !important"}},sa={class:"card-image"},ia={class:"image is-4by3"},oa=["src"],na={class:"content",style:{display:"flex","justify-content":"center"}},ra={style:{padding:"10px !important"}},da=g(()=>l("span",{style:{"margin-left":"10px"}},null,-1)),ca={class:"column is-mobile-12 is-12",style:{"text-align":"right"}},ma={key:0,class:"column is-mobile-12 is-12"},pa={class:"column is-mobile-12 is-12 text-right"},ua=g(()=>l("i",{class:"pi pi-save",style:{"margin-right":"8px"}},null,-1)),ha=ie({__name:"EditHouse",setup(k){const{t:d}=qe(),u=De(),z=Me(),h=Re(),{form:t,state:p,update:oe,getOne:ne,houseGetByOne:M,deleteGallery:re,updateGallery:de,addGallery:ce}=el(),{getOne:me,realestateType:pe}=Ze(),{getAll:ue,state:he,setStateFilter:ge}=ll(),{getAll:W,state:_e,setStateFilter:U}=al(),F=_(),S=_(),Q=_([{id:"",image:""}]),I=_(),X=_(),J=localStorage.getItem("token"),fe=async()=>{z.push({name:"owner.house"})},ve=async()=>{t.prices&&(t.prices.length>2?u.add({severity:"error",summary:d("toast.summary.must_be_length_three"),detail:d("toast.detail.cancel_delete"),life:3e3}):t.prices.push({price:"",unit_price:"",detail:""}))},ye=async e=>{t.prices&&t.prices.splice(e,1)},{handleSubmit:we,setFieldValue:w}=Je({validationSchema:Ye}),be=_([{id:"sale",name:"ບໍລິການຂາຍ"},{id:"rent",name:"ບໍລິການເຊົ່າ"}]),$e=_([{id:"air",name:"ເເອ"},{id:"fan",name:"ພັດລົມ"},{id:"no",name:"ບໍ່ມີ"}]),Se=_([{id:"sale",name:"ບໍລິການຂາຍ"},{id:"day",name:"ບໍລິການ ເຊົ່າເປັນມື້"},{id:"month",name:"ບໍລິການ ເຊົ່າເປັນເດືອນ"},{id:"year",name:"ບໍລິການ ເຊົ່າເປັນປີ"}]);Ae(async()=>{await T()});const T=async()=>{const e=Number(h.params.id);p.btnLoading=!0,await ne(e),await Ve(),p.btnLoading=!1},Ve=async()=>{const e=M.data.props;w("village",e.village),w("zipcode",e.zip_code),w("wide",e.wide),w("long",e.long),w("location",e.location),w("name",e.name),w("bed",e.total_bed),w("bath",e.total_bath),w("garage",e.garage),t.room_type=e.room_type,t.service_model=e.service_model,t.remark=e.remark,t.prices=e.price,F.value=e.image,Q.value=e.gallery,ge.limit=1e3,await ue(),await me(),t.real_estate_type_id=e.real_estate_type?e.real_estate_type.id:void 0,t.province_id=e.province?e.province.id:void 0,U.filter&&(U.filter.province_id=t.province_id,await W(),await K())},ke=async e=>{U.filter&&(U.filter.province_id=e,await W(),await K())},K=async()=>{t.district_id=M.data.props.district?M.data.props.district.id:void 0},Y=we(async e=>{t.id=String(h.params.id),t.village=e.village,t.name=e.name,t.zip_code=e.zipcode,t.wide=e.wide,t.long=e.long,t.total_bed=e.bed,t.total_bath=e.bath,t.garage=e.garage,t.name=e.name,t.remark=e.remark,t.location=e.location,t.image=S.value,await oe(),p.error?await G():(await E(),await T(),await B())}),Ie=()=>{document.getElementById("fileInput").click()},Ce=async e=>{var r;const i=e.target,a=(r=i.files)==null?void 0:r[0];if(a){if(!await te(a)){await D({toast:u,error:"error",summary:d("toast.summary.error"),detail:d("toast.summary.real_estate_profile_valid_file_mimes")}),i.value="",S.value="";return}if(!await se(a)){await D({toast:u,error:"error",summary:d("toast.summary.error"),detail:d("toast.summary.real_estate_profile_valid_file_size")}),i.value="",S.value="";return}const o=new Image;o.src=URL.createObjectURL(a),o.onload=async()=>{const c=o.width,b=o.height;c>R.value||b>A.value?(S.value="",i.value="",await ee(d("messages.dimensions"))):(await le(a,"image"),await Y())}}},Z=(e,i)=>{t.id=e,X.value=i,X.value==="update"?(document.getElementById("updateGalleryInput").click(),V.value=[]):(document.getElementById("addGalleryInput").click(),V.value=[])},Fe=async e=>{await re(e),p.error?await G():(await E(),await T(),await B())},Te=async e=>{var r;const i=e.target,a=(r=i.files)==null?void 0:r[0];if(a){if(!await te(a)){await D({toast:u,error:"error",summary:d("toast.summary.error"),detail:d("toast.summary.real_estate_profile_valid_file_mimes")}),i.value="",F.value="",S.value="";return}if(!await se(a)){await D({toast:u,error:"error",summary:d("toast.summary.error"),detail:d("toast.summary.real_estate_profile_valid_file_size")}),i.value="",F.value="",S.value="";return}const o=new Image;o.src=URL.createObjectURL(a),o.onload=async()=>{const c=o.width,b=o.height;c>R.value||b>A.value?(I.value="",i.value="",await ee(d("messages.dimensions"))):(await le(a,"gallery"),t.gallery=I.value,await de(),p.error?await G():(await E(),await T(),await B()))}}},V=_([]),R=_(2e3),A=_(1900),Le=async e=>{const i=e.target,a=i.files,r=1*1024*1024,o=5*1024*1024;if(a){let c=0;for(let b=0;b<a.length;b++){const O=a[b];c+=O.size;try{await ze(O,r)}catch(Ge){V.value.push(Ge)}}if(c>o){V.value.push(d("toast.summary.maximum_allowed_size_5MB")),i.value="";return}V.value.length<=0?(await Ue(a),t.gallery=I.value,await ce(),p.error?await G():(await E(),await T(),await B())):i.value=""}},ze=(e,i)=>new Promise((a,r)=>{if(e.size>i)r(`${e.name} => `+d("toast.summary.real_estate_profile_valid_file_size_1MB"));else if(!["image/jpeg","image/jpg"].includes(e.type))r(`${e.name} => `+d("toast.summary.real_estate_profile_valid_file_mimes"));else{const c=new Image;c.src=URL.createObjectURL(e),c.onload=()=>{const b=c.width,O=c.height;b>R.value||O>A.value?r(`${e.name} => `+d("messages.dimensions")):a("")},c.onerror=()=>{r(`Error loading image ${e.name}.`)}}}),ee=e=>{u.add({severity:"error",summary:d("toast.summary.error"),detail:e,life:3e3})},G=()=>{u.add({severity:"error",summary:d("toast.summary.error"),detail:`${p.error}`,life:3e3})},B=()=>{u.add({severity:"success",summary:d("toast.summary.success"),detail:d("toast.detail.successfully"),life:3e3})},E=async()=>{F.value="",S.value="",I.value="";const e=document.getElementById("fileInput");e.value="";const i=document.getElementById("updateGalleryInput");i.value="";const a=document.getElementById("addGalleryInput");a.value=""},Ue=async e=>{p.btnLoading=!0;try{let i=new FormData;for(let o=0;o<e.length;o++)i.append("files[]",e[o]);const r=(await ae.post("http://188.166.183.153:8000/api/upload/multiple/files",i,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${J}`}})).data.filename.map(o=>({image:`${o}`}));I.value=r,p.btnLoading=!1}catch(i){console.error("Upload failed:",i)}},le=async(e,i)=>{var a,r;p.btnLoading=!0;try{let o=new FormData;o.append("file",e);const c=await ae.post("http://188.166.183.153:8000/api/upload_file",o,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${J}`}});i==="image"?S.value=(a=c.data)==null?void 0:a.filename:I.value=(r=c.data)==null?void 0:r.filename,p.btnLoading=!1}catch(o){console.error("Upload failed:",o)}};return(e,i)=>(v(),f("div",rl,[l("div",dl,[l("span",cl,[l("h2",{style:{"font-weight":"bold","font-size":"20px"},class:"arrow-left",onClick:i[0]||(i[0]=a=>fe())},[ml,y(" "+m(e.$t("messages.form_register")),1)])])]),pl,n(s(j)),l("form",{onSubmit:i[8]||(i[8]=Ne(a=>s(Y)(),["prevent"])),class:"flex flex-column gap-3 h-full"},[l("div",ul,[l("div",hl,[l("label",null,[y(m(e.$t("messages.realestate_type"))+" ",1),gl]),n(s(C),{name:"real_estate_type",style:{"margin-top":"8px"},modelValue:s(t).real_estate_type_id,"onUpdate:modelValue":i[1]||(i[1]=a=>s(t).real_estate_type_id=a),options:s(pe).props,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0},null,8,["modelValue","options","placeholder"])]),l("div",_l,[l("label",null,[y(m(e.$t("messages.service_model"))+" ",1),fl]),n(s(C),{style:{"margin-top":"8px"},modelValue:s(t).service_model,"onUpdate:modelValue":i[2]||(i[2]=a=>s(t).service_model=a),options:be.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),optionValue:"id",highlightOnSelect:!0,class:"w-full"},null,8,["modelValue","options","placeholder"])]),l("div",vl,[l("label",null,[y(m(e.$t("messages.room_type"))+" ",1),yl]),n(s(C),{style:{"margin-top":"8px"},modelValue:s(t).room_type,"onUpdate:modelValue":i[3]||(i[3]=a=>s(t).room_type=a),options:$e.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0},null,8,["modelValue","options","placeholder"])]),l("div",wl,[n($,{name:"name",label:e.$t("messages.name"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),l("div",bl,[l("label",null,[y(m(e.$t("messages.province"))+" ",1),$l]),n(s(C),{style:{"margin-top":"8px"},modelValue:s(t).province_id,"onUpdate:modelValue":i[4]||(i[4]=a=>s(t).province_id=a),options:s(he).data.props,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0,filter:"",onChange:i[5]||(i[5]=a=>ke(s(t).province_id))},null,8,["modelValue","options","placeholder"])]),l("div",Sl,[l("label",null,[y(m(e.$t("messages.district"))+" ",1),Vl]),n(s(C),{style:{"margin-top":"8px"},modelValue:s(t).district_id,"onUpdate:modelValue":i[6]||(i[6]=a=>s(t).district_id=a),options:s(_e).data.props,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0,filter:""},null,8,["modelValue","options","placeholder"])]),l("div",kl,[n($,{name:"village",label:e.$t("messages.village"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:s(t).village},null,8,["label","placeholder","value"])]),l("div",Il,[n($,{name:"zipcode",label:e.$t("messages.zip_code"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:s(t).zip_code},null,8,["label","placeholder","value"])]),l("div",Cl,[n($,{name:"bed",label:e.$t("messages.total_bed"),placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),l("div",Fl,[n($,{name:"bath",label:e.$t("messages.total_bath"),placeholder:e.$t("placeholder.inputText"),class:"h-full"},null,8,["label","placeholder"])]),l("div",Tl,[n($,{name:"wide",label:e.$t("messages.wide"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:s(t).wide},null,8,["label","placeholder","value"])]),l("div",Ll,[n($,{name:"long",label:e.$t("messages.long"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:s(t).long},null,8,["label","placeholder","value"])]),l("div",zl,[n($,{name:"garage",label:e.$t("messages.garage"),required:"",placeholder:e.$t("placeholder.inputTextGarage"),class:"h-full"},null,8,["label","placeholder"])]),l("div",Ul,[n($,{name:"location",label:e.$t("messages.location"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:s(t).location},null,8,["label","placeholder","value"])]),l("div",Gl,[n(nl,{name:"remark",label:e.$t("messages.remark"),required:"",placeholder:e.$t("placeholder.inputText"),class:"h-full",value:s(t).remark},null,8,["label","placeholder","value"])]),l("div",Bl,[n(s(P),{header:e.$t("messages.setting_price_for_rent")},{default:q(()=>[(v(!0),f(N,null,x(s(t).prices,(a,r)=>(v(),f("div",{class:"columns is-12",key:r},[l("div",El,[l("label",null,[y(m(e.$t("messages.service_model"))+" ",1),Ol]),n(s(C),{modelValue:a.unit_price,"onUpdate:modelValue":o=>a.unit_price=o,options:Se.value,optionLabel:"name",placeholder:e.$t("placeholder.dropdownSelect"),class:"w-full",optionValue:"id",highlightOnSelect:!0,required:""},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),l("div",ql,[l("label",null,[y(m(e.$t("messages.price"))+" ",1),Dl]),n(s(Ke),{modelValue:a.price,"onUpdate:modelValue":o=>a.price=o,placeholder:e.$t("placeholder.inputText"),required:"",style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'",width:"100% !important"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),l("div",Ml,[l("label",null,m(e.$t("messages.details")),1),je(l("input",{name:"detail",type:"text",class:"input","onUpdate:modelValue":o=>a.detail=o,placeholder:e.$t("placeholder.inputText"),style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"}},null,8,Rl),[[He,a.detail]])]),l("div",Al,[r>0?(v(),f("a",{key:0,onClick:o=>ye(r),class:"button is-danger remove-btn",style:{"margin-top":"22px"}},Pl,8,Nl)):H("",!0)])]))),128)),l("div",jl,[l("a",{onClick:ve,class:"button is-primary"},m(e.$t("button.add_item")),1)])]),_:1},8,["header"])]),l("div",Hl,[n(s(P),{header:e.$t("messages.profile")},{default:q(()=>[l("div",Wl,[l("div",Ql,[l("div",Xl,[l("div",Jl,[l("figure",Kl,[l("img",{src:F.value,alt:"Placeholder image"},null,8,Yl)])]),l("div",Zl,[l("span",ea,[n(s(L),{icon:"pi pi-pencil",severity:"warning",rounded:"",onClick:Ie,style:{color:"white"}}),l("input",{type:"file",id:"fileInput",style:{display:"none"},onChange:Ce},null,32)])])])])])]),_:1},8,["header"])]),l("div",la,[n(s(P),{header:e.$t("messages.profile_and_gallery")},{default:q(()=>[l("div",aa,[(v(!0),f(N,null,x(Q.value,(a,r)=>(v(),f("div",{class:"column is-mobile-12 is-3",key:r},[l("div",ta,[l("div",sa,[l("figure",ia,[l("img",{src:a==null?void 0:a.image,alt:"Placeholder image"},null,8,oa)])]),l("div",na,[l("span",ra,[n(s(L),{icon:"pi pi-trash",severity:"danger",rounded:"",onClick:o=>Fe(a.id)},null,8,["onClick"]),da,n(s(L),{icon:"pi pi-pencil",severity:"warning",rounded:"",onClick:o=>Z(a.id,"update"),style:{color:"white"}},null,8,["onClick"])]),l("input",{type:"file",id:"updateGalleryInput",style:{display:"none"},onChange:Te},null,32),l("input",{type:"file",id:"addGalleryInput",multiple:"",style:{display:"none"},onChange:Le},null,32)])])]))),128)),n(s(j)),l("div",ca,[n(s(L),{icon:"pi pi-plus-circle",onClick:i[7]||(i[7]=a=>Z(s(h).params.id,"add"))})]),n(s(j)),V.value.length>0?(v(),f("div",ma,[(v(!0),f(N,null,x(V.value,(a,r)=>(v(),f("p",{style:{color:"red"},key:r},m(r+1)+". "+m(a),1))),128))])):H("",!0)])]),_:1},8,["header"])]),l("div",pa,[n(s(L),{style:{"font-family":"'NotoSansLao','Montserrat', 'sans-serif'"},type:"submit",severity:"info",loading:s(p).btnLoading},{default:q(()=>[ua,y(" "+m(e.$t("button.edit_data")),1)]),_:1},8,["loading"])])])],32)]))}}),Ga=We(ha,[["__scopeId","data-v-e850fd30"]]);export{Ga as default};
